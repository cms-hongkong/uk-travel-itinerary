<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英倫風旅行行程管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.0/firebase-app-compat/dist/index.cjs.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.0/firebase-database-compat/dist/index.cjs.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-british: #1E3A8A; /* 英國皇家藍 */
            --secondary-british: #B91C1C; /* 英國紅 */
            --accent-british: #047857; /* 英國綠 */
            --light-british: #FEF3C7; /* 淺米色 */
            --dark-british: #0F172A; /* 深藍黑 */
        }
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .playfair-display {
            font-family: 'Playfair Display', serif;
        }
        
        body {
            background-color: #f8f9fa;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            position: relative;
        }
        
        .tab-active {
            color: var(--primary-british);
            border-bottom: 3px solid var(--primary-british);
        }
        
        .card-shadow {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .british-gradient {
            background: linear-gradient(135deg, var(--primary-british) 0%, var(--accent-british) 100%);
        }
        
        .header-image {
            height: 250px;
            background-image: url('https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80');
            background-size: cover;
            background-position: center;
            position: relative;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
        }
        
        .header-overlay {
            background: linear-gradient(to bottom, rgba(30, 58, 138, 0.2), rgba(30, 58, 138, 0.5));
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
        }
        
        .tab-container {
            margin-top: -40px;
            z-index: 10;
            position: relative;
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-british);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
            z-index: 100;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            background-color: var(--secondary-british);
        }
        
        .day-selector::-webkit-scrollbar {
            height: 6px;
        }
        
        .day-selector::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .day-selector::-webkit-scrollbar-thumb {
            background: var(--primary-british);
            border-radius: 10px;
        }
        
        .drag-handle {
            cursor: move;
        }
        
        .weather-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .flight-card {
            background: linear-gradient(135deg, #0F172A 0%, #1E3A8A 100%);
            color: white;
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .category-attraction {
            background-color: #DBEAFE;
            color: var(--primary-british);
        }
        
        .category-accommodation {
            background-color: #D1FAE5;
            color: var(--accent-british);
        }
        
        .category-food {
            background-color: #FEF3C7;
            color: #B45309;
        }
        
        .category-shopping {
            background-color: #FCE7F3;
            color: #BE185D;
        }
        
        .category-flight {
            background-color: #E0E7FF;
            color: #3730A3;
        }
        
        .category-other {
            background-color: #F3F4F6;
            color: #4B5563;
        }
        
        .transport-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        
        .transport-walk {
            background-color: #10B981;
            color: white;
        }
        
        .transport-drive {
            background-color: #3B82F6;
            color: white;
        }
        
        .transport-transit {
            background-color: #8B5CF6;
            color: white;
        }
        
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        
        .sync-indicator.syncing {
            color: #3B82F6;
        }
        
        .sync-indicator.synced {
            color: #10B981;
        }
        
        .sync-indicator.error {
            color: #EF4444;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 同步狀態指示器 -->
        <div v-if="showSyncIndicator" :class="['sync-indicator', syncStatus]">
            <i :class="syncIcon" class="mr-2"></i>
            {{ syncMessage }}
        </div>
        
        <!-- 頁首 -->
        <header class="header-image">
            <div class="header-overlay"></div>
            <div class="absolute top-5 left-5 text-white">
                <h1 class="playfair-display text-3xl font-bold">英倫之旅</h1>
                <p class="text-sm mt-1">2026年7月29日 - 8月13日</p>
            </div>
            
            <!-- Tab導航按鈕 -->
            <div class="tab-container flex justify-end px-5 space-x-6">
                <button 
                    @click="currentTab = 'itinerary'" 
                    :class="{'tab-active': currentTab === 'itinerary'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-map-marker-alt text-xl"></i>
                    <span class="text-xs mt-1">行程</span>
                </button>
                <button 
                    @click="currentTab = 'info'" 
                    :class="{'tab-active': currentTab === 'info'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-info-circle text-xl"></i>
                    <span class="text-xs mt-1">資訊</span>
                </button>
                <button 
                    @click="currentTab = 'shopping'" 
                    :class="{'tab-active': currentTab === 'shopping'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-shopping-basket text-xl"></i>
                    <span class="text-xs mt-1">購物</span>
                </button>
                <button 
                    @click="currentTab = 'expenses'" 
                    :class="{'tab-active': currentTab === 'expenses'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-money-bill-wave text-xl"></i>
                    <span class="text-xs mt-1">花費</span>
                </button>
            </div>
        </header>

        <!-- 主要內容區域 -->
        <main class="px-5 pb-24 -mt-6">
            <!-- 行程頁面 -->
            <div v-if="currentTab === 'itinerary'" class="space-y-6">
                <!-- 日期選擇器 -->
                <div class="day-selector flex space-x-4 overflow-x-auto py-2">
                    <div 
                        v-for="day in days" 
                        :key="day.id"
                        @click="selectDay(day.id)"
                        :class="{'bg-blue-50 border border-blue-200': selectedDay === day.id}"
                        class="flex-shrink-0 w-16 p-3 rounded-xl text-center cursor-pointer hover:bg-blue-50 transition-colors"
                    >
                        <div class="text-sm font-semibold text-blue-800">{{ day.dayOfWeek }}</div>
                        <div class="text-2xl font-bold text-gray-800">{{ day.date }}</div>
                        <div class="text-xs text-gray-500 mt-1">{{ day.month }}</div>
                    </div>
                </div>
                
                <!-- 天氣資訊 -->
                <div v-if="weatherData[selectedDay]" class="weather-card rounded-2xl p-5 card-shadow">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg">{{ getDayLocation(selectedDay) }} 天氣</h3>
                            <div class="flex items-center mt-2">
                                <i :class="weatherData[selectedDay].icon" class="text-3xl mr-4"></i>
                                <div>
                                    <div class="text-3xl font-bold">{{ weatherData[selectedDay].temp }}°C</div>
                                    <div class="text-sm opacity-90">體感溫度: {{ weatherData[selectedDay].feelsLike }}°C</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">{{ weatherData[selectedDay].condition }}</div>
                            <div class="text-sm mt-2">濕度: {{ weatherData[selectedDay].humidity }}%</div>
                            <div class="text-sm">風速: {{ weatherData[selectedDay].windSpeed }} km/h</div>
                        </div>
                    </div>
                </div>
                
                <!-- 行程分類篩選 -->
                <div class="flex space-x-2 overflow-x-auto py-2">
                    <button 
                        v-for="category in categories" 
                        :key="category.id"
                        @click="toggleCategoryFilter(category.id)"
                        :class="getCategoryClass(category.id, categoryFilter.includes(category.id))"
                        class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium"
                    >
                        {{ category.name }}
                    </button>
                </div>
                
                <!-- 行程列表 -->
                <div class="space-y-6">
                    <div 
                        v-for="(item, index) in filteredItineraryItems" 
                        :key="item.id"
                        class="bg-white rounded-2xl p-5 card-shadow"
                        :draggable="true"
                        @dragstart="dragStart(index)"
                        @dragover.prevent="dragOver(index)"
                        @drop="drop(index)"
                    >
                        <!-- 航班資訊卡片（特殊樣式） -->
                        <div v-if="item.category === 'flight'" class="flight-card rounded-2xl p-5">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-xl font-bold">{{ item.title }}</div>
                                    <div class="flex items-center mt-2">
                                        <div class="text-2xl font-bold">{{ item.fromCode }}</div>
                                        <div class="mx-3">
                                            <i class="fas fa-plane"></i>
                                        </div>
                                        <div class="text-2xl font-bold">{{ item.toCode }}</div>
                                    </div>
                                    <div class="mt-3 text-sm opacity-90">
                                        <div>航班: {{ item.flightNumber }}</div>
                                        <div>出發: {{ item.departureTime }}</div>
                                        <div>抵達: {{ item.arrivalTime }}</div>
                                        <div>航空公司: {{ item.airline }}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="category-badge category-flight">{{ getCategoryName('flight') }}</span>
                                </div>
                            </div>
                            <button 
                                @click="openGoogleMaps(item.location, item.title)"
                                class="mt-4 w-full bg-white text-blue-900 py-2 rounded-lg font-semibold flex items-center justify-center"
                            >
                                <i class="fas fa-map-marked-alt mr-2"></i> Google Maps 導航
                            </button>
                        </div>
                        
                        <!-- 一般行程卡片 -->
                        <div v-else>
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center">
                                        <i class="fas fa-grip-vertical text-gray-400 mr-3 drag-handle"></i>
                                        <div>
                                            <div class="flex items-center">
                                                <span class="category-badge" :class="getCategoryBadgeClass(item.category)">
                                                    {{ getCategoryName(item.category) }}
                                                </span>
                                                <span class="ml-3 text-sm text-gray-500">{{ item.time }}</span>
                                            </div>
                                            <h3 class="text-xl font-bold mt-2">{{ item.title }}</h3>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 space-y-2">
                                        <div v-if="item.openingHours" class="flex items-center text-gray-700">
                                            <i class="far fa-clock w-5 mr-2"></i>
                                            <span>{{ item.openingHours }}</span>
                                        </div>
                                        <div v-if="item.ticketPrice" class="flex items-center text-gray-700">
                                            <i class="fas fa-ticket-alt w-5 mr-2"></i>
                                            <span>{{ item.ticketPrice }}</span>
                                        </div>
                                        <div v-if="item.notes" class="text-gray-700">
                                            <i class="fas fa-star w-5 mr-2 inline-block align-top"></i>
                                            <span>{{ item.notes }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button @click="editItineraryItem(item)" class="text-blue-700 hover:text-blue-900">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 交通時間（除了最後一個項目） -->
                            <div v-if="index < filteredItineraryItems.length - 1 && item.transportTime" class="mt-5 pt-5 border-t border-gray-100">
                                <div class="flex items-center text-gray-600">
                                    <div class="transport-icon" :class="getTransportClass(item.transportType)">
                                        <i :class="getTransportIcon(item.transportType)"></i>
                                    </div>
                                    <div>
                                        <span class="font-medium">{{ item.transportTime }}</span>
                                        <span class="text-sm ml-2">前往下個行程</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 導航按鈕 -->
                            <button 
                                @click="openGoogleMaps(item.location, item.title)"
                                class="mt-5 w-full bg-blue-50 text-blue-700 py-3 rounded-xl font-semibold flex items-center justify-center hover:bg-blue-100 transition-colors"
                            >
                                <i class="fas fa-map-marked-alt mr-2"></i> Google Maps 導航
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 資訊頁面 -->
            <div v-if="currentTab === 'info'" class="space-y-6">
                <!-- 匯率換算 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-exchange-alt mr-3 text-blue-700"></i> 匯率換算
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-1">輸入金額 (GBP)</label>
                                <input 
                                    type="number" 
                                    v-model="gbpAmount" 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="輸入英鎊金額"
                                >
                            </div>
                            <div class="pt-5">
                                <i class="fas fa-arrow-right text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-1">換算為港幣 (HKD)</label>
                                <div class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50">
                                    {{ calculatedHKD }} HKD
                                </div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i> 匯率: 1 GBP = {{ exchangeRate }} HKD (更新時間: {{ exchangeRateDate }})
                        </div>
                    </div>
                </div>
                
                <!-- 航班資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-plane mr-3 text-blue-700"></i> 航班資訊
                    </h2>
                    
                    <!-- 去程航班 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-blue-800">去程</h3>
                        <div class="bg-blue-50 rounded-xl p-4">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <div class="text-sm text-gray-600">出發</div>
                                    <div class="text-xl font-bold">香港 (HKG)</div>
                                    <div class="text-sm">28 七月 2026, 23:15</div>
                                </div>
                                <div class="text-center">
                                    <i class="fas fa-plane text-blue-500 text-2xl"></i>
                                    <div class="text-xs mt-1">飛行時間 12小時</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">抵達</div>
                                    <div class="text-xl font-bold">蘇黎世 (ZRH)</div>
                                    <div class="text-sm">29 七月 2026, 06:15</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">航班:</span> LX139
                                </div>
                                <div>
                                    <span class="text-gray-600">航空公司:</span> SWISS
                                </div>
                                <div>
                                    <span class="text-gray-600">登機:</span> 香港 HKG, 航站樓 1
                                </div>
                                <div>
                                    <span class="text-gray-600">艙位:</span> Economy Basic (T)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 回程航班 -->
                    <div>
                        <h3 class="font-bold text-lg mb-3 text-blue-800">回程</h3>
                        <div class="bg-blue-50 rounded-xl p-4">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <div class="text-sm text-gray-600">出發</div>
                                    <div class="text-xl font-bold">曼徹斯特 (MAN)</div>
                                    <div class="text-sm">13 八月 2026, 18:40</div>
                                </div>
                                <div class="text-center">
                                    <i class="fas fa-plane text-blue-500 text-2xl"></i>
                                    <div class="text-xs mt-1">轉機蘇黎世</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">抵達</div>
                                    <div class="text-xl font-bold">香港 (HKG)</div>
                                    <div class="text-sm">14 八月 2026, 16:40</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">航班:</span> LX381 + LX138
                                </div>
                                <div>
                                    <span class="text-gray-600">航空公司:</span> SWISS
                                </div>
                                <div>
                                    <span class="text-gray-600">轉機:</span> 蘇黎世 (1小時)
                                </div>
                                <div>
                                    <span class="text-gray-600">艙位:</span> Economy Basic (T)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 住宿資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-hotel mr-3 text-blue-700"></i> 住宿資訊
                    </h2>
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-bed text-4xl mb-3"></i>
                        <div>住宿資訊後補，尚未預訂</div>
                    </div>
                </div>
                
                <!-- 租車資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-car mr-3 text-blue-700"></i> 租車資訊
                    </h2>
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-car text-4xl mb-3"></i>
                        <div>租車資訊後補，尚未預訂</div>
                    </div>
                </div>
                
                <!-- 緊急醫療資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-ambulance mr-3 text-red-600"></i> 緊急聯絡
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center p-3 bg-red-50 rounded-lg">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-police-box text-red-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold">警察</div>
                                <div class="text-sm text-gray-600">緊急電話: 999</div>
                            </div>
                            <button class="text-red-600" @click="callEmergency('999')">
                                <i class="fas fa-phone-alt"></i>
                            </button>
                        </div>
                        <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-ambulance text-blue-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold">救護車</div>
                                <div class="text-sm text-gray-600">緊急電話: 999</div>
                            </div>
                            <button class="text-blue-600" @click="callEmergency('999')">
                                <i class="fas fa-phone-alt"></i>
                            </button>
                        </div>
                        <div class="flex items-center p-3 bg-green-50 rounded-lg">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-fire-extinguisher text-green-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold">消防隊</div>
                                <div class="text-sm text-gray-600">緊急電話: 999</div>
                            </div>
                            <button class="text-green-600" @click="callEmergency('999')">
                                <i class="fas fa-phone-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 購物清單頁面 -->
            <div v-if="currentTab === 'shopping'" class="space-y-6">
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-6">購物清單</h2>
                    
                    <div v-if="shoppingList.length === 0" class="text-center py-10 text-gray-500">
                        <i class="fas fa-shopping-basket text-4xl mb-3"></i>
                        <div>購物清單為空</div>
                        <div class="text-sm mt-1">點擊右下角的 + 按鈕新增商品</div>
                    </div>
                    
                    <div v-else class="space-y-4">
                        <div 
                            v-for="item in shoppingList" 
                            :key="item.id"
                            class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-gray-50"
                        >
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center mr-4">
                                <i v-if="!item.image" class="fas fa-shopping-bag text-gray-500 text-xl"></i>
                                <img v-else :src="item.image" :alt="item.name" class="w-full h-full object-cover rounded-lg">
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold">{{ item.name }}</h3>
                                <div class="text-sm text-gray-500 mt-1">添加日期: {{ item.addedDate }}</div>
                                <div v-if="item.notes" class="text-sm text-gray-600 mt-1">{{ item.notes }}</div>
                            </div>
                            <button @click="removeShoppingItem(item.id)" class="text-red-500 hover:text-red-700 ml-2">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 花費頁面 -->
            <div v-if="currentTab === 'expenses'" class="space-y-6">
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <!-- 總花費 -->
                    <div class="mb-6">
                        <h2 class="text-xl font-bold mb-2">總花費</h2>
                        <div class="text-3xl font-bold text-blue-800">{{ totalExpenses }} GBP</div>
                        <div class="text-sm text-gray-500 mt-1">約 {{ Math.round(totalExpenses * exchangeRate) }} HKD</div>
                    </div>
                    
                    <!-- 花費列表 -->
                    <h3 class="font-bold mb-4">花費記錄</h3>
                    
                    <div v-if="expenses.length === 0" class="text-center py-10 text-gray-500">
                        <i class="fas fa-receipt text-4xl mb-3"></i>
                        <div>尚未記錄任何花費</div>
                        <div class="text-sm mt-1">點擊右下角的 + 按鈕新增記錄</div>
                    </div>
                    
                    <div v-else class="space-y-4">
                        <div 
                            v-for="expense in expenses" 
                            :key="expense.id"
                            class="p-4 border border-gray-200 rounded-xl"
                        >
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center">
                                        <span class="category-badge" :class="getExpenseCategoryClass(expense.category)">
                                            {{ getExpenseCategoryName(expense.category) }}
                                        </span>
                                        <span class="ml-3 text-sm text-gray-500">{{ expense.date }}</span>
                                    </div>
                                    <h3 class="font-bold text-lg mt-2">{{ expense.name }}</h3>
                                    <div class="text-gray-700 mt-2">{{ expense.notes || '無備註' }}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xl font-bold text-blue-800">{{ expense.amount }} GBP</div>
                                    <div class="text-sm text-gray-500 mt-1">{{ expense.paymentMethod }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 浮動操作按鈕 -->
        <div 
            v-if="showFAB" 
            @click="handleFABClick"
            class="floating-action-btn"
        >
            <i class="fas fa-plus text-xl"></i>
        </div>
        
        <!-- 新增/編輯行程模態框 -->
        <div v-if="showItineraryModal" class="modal-overlay">
            <div class="modal-content w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">{{ editingItineraryItem ? '編輯行程' : '新增行程' }}</h3>
                        <button @click="closeItineraryModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">行程名稱 *</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.title"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入行程名稱"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">分類</label>
                            <select 
                                v-model="itineraryForm.category"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="attraction">景點</option>
                                <option value="accommodation">住宿</option>
                                <option value="food">美食</option>
                                <option value="shopping">購物</option>
                                <option value="flight">航班</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">時間</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.time"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: 09:00-12:00"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">營業時間</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.openingHours"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: 09:00-18:00"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">門票價格</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.ticketPrice"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: £18/人"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">特色與備註</label>
                            <textarea 
                                v-model="itineraryForm.notes"
                                rows="3"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入特色與備註"
                            ></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">交通方式</label>
                            <select 
                                v-model="itineraryForm.transportType"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="walk">步行</option>
                                <option value="drive">開車</option>
                                <option value="transit">大眾運輸</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">交通時間</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.transportTime"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: 30分鐘"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">地點 (用於Google Maps導航) *</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.location"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入地址或地點名稱"
                            >
                        </div>
                    </div>
                    
                    <div class="flex justify-between mt-8">
                        <button 
                            v-if="editingItineraryItem"
                            @click="confirmDeleteItineraryItem"
                            class="px-5 py-3 bg-red-100 text-red-700 rounded-lg font-medium hover:bg-red-200"
                        >
                            刪除行程
                        </button>
                        <div v-else></div>
                        
                        <div class="space-x-3">
                            <button 
                                @click="closeItineraryModal"
                                class="px-5 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50"
                            >
                                取消
                            </button>
                            <button 
                                @click="saveItineraryItem"
                                class="px-5 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                儲存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 新增購物項目模態框 -->
        <div v-if="showShoppingModal" class="modal-overlay">
            <div class="modal-content w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">新增購物項目</h3>
                        <button @click="closeShoppingModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">商品名稱 *</label>
                            <input 
                                type="text" 
                                v-model="shoppingForm.name"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入商品名稱"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">商品圖片 (URL)</label>
                            <input 
                                type="text" 
                                v-model="shoppingForm.image"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入圖片網址 (選填)"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">備註</label>
                            <textarea 
                                v-model="shoppingForm.notes"
                                rows="2"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入備註 (選填)"
                            ></textarea>
                        </div>
                        
                        <div class="pt-4">
                            <button 
                                @click="saveShoppingItem"
                                class="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                儲存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 新增花費模態框 -->
        <div v-if="showExpenseModal" class="modal-overlay">
            <div class="modal-content w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">新增花費記錄</h3>
                        <button @click="closeExpenseModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">類別</label>
                            <select 
                                v-model="expenseForm.category"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="transport">交通</option>
                                <option value="food">飲食</option>
                                <option value="accommodation">住宿</option>
                                <option value="ticket">門票</option>
                                <option value="shopping">購物</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">名稱 *</label>
                            <input 
                                type="text" 
                                v-model="expenseForm.name"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入花費項目名稱"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                            <input 
                                type="date" 
                                v-model="expenseForm.date"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">金額 (GBP) *</label>
                            <input 
                                type="number" 
                                v-model="expenseForm.amount"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入金額"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">付款方式</label>
                            <select 
                                v-model="expenseForm.paymentMethod"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="現金">現金</option>
                                <option value="信用卡">信用卡</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">備註</label>
                            <textarea 
                                v-model="expenseForm.notes"
                                rows="2"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入備註 (選填)"
                            ></textarea>
                        </div>
                        
                        <div class="pt-4">
                            <button 
                                @click="saveExpense"
                                class="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                儲存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 刪除確認模態框 -->
        <div v-if="showDeleteConfirmModal" class="modal-overlay">
            <div class="modal-content w-full max-w-sm">
                <div class="p-6">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">確認刪除</h3>
                        <p class="text-gray-600 mb-6">您確定要刪除這個項目嗎？此操作無法復原。</p>
                        
                        <div class="flex space-x-3">
                            <button 
                                @click="showDeleteConfirmModal = false"
                                class="flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50"
                            >
                                取消
                            </button>
                            <button 
                                @click="deleteItineraryItem"
                                class="flex-1 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700"
                            >
                                刪除
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;
        
        // Firebase 配置 (公開項目，僅用於演示)
        const firebaseConfig = {
            apiKey: "AIzaSyC4mOKHrj8VlA3JGKXkhNdGdvI3tLf7eE0",
            authDomain: "uk-travel-itinerary.firebaseapp.com",
            databaseURL: "https://uk-travel-itinerary-default-rtdb.firebaseio.com",
            projectId: "uk-travel-itinerary",
            storageBucket: "uk-travel-itinerary.firebasestorage.app",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };
        
        createApp({
            setup() {
                // 初始化 Firebase
                let firebaseApp, database;
                try {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                    database = firebase.database(firebaseApp);
                } catch (error) {
                    console.log("Firebase 初始化失敗，使用本地儲存:", error);
                }
                
                // 當前選中的標籤頁
                const currentTab = ref('itinerary');
                
                // 當前選中的日期
                const selectedDay = ref(1);
                
                // 分類篩選
                const categoryFilter = ref([]);
                
                // 顯示的模態框
                const showItineraryModal = ref(false);
                const showShoppingModal = ref(false);
                const showExpenseModal = ref(false);
                const showDeleteConfirmModal = ref(false);
                
                // 同步狀態
                const syncStatus = ref('synced'); // 'syncing', 'synced', 'error'
                const syncMessage = ref('已同步');
                const showSyncIndicator = ref(false);
                
                // 是否顯示浮動操作按鈕
                const showFAB = computed(() => {
                    return currentTab.value === 'itinerary' || 
                           currentTab.value === 'shopping' || 
                           currentTab.value === 'expenses';
                });
                
                // 編輯中的行程項目
                const editingItineraryItem = ref(null);
                
                // 同步圖標
                const syncIcon = computed(() => {
                    switch(syncStatus.value) {
                        case 'syncing': return 'fas fa-sync-alt animate-spin';
                        case 'synced': return 'fas fa-check-circle';
                        case 'error': return 'fas fa-exclamation-triangle';
                        default: return 'fas fa-check-circle';
                    }
                });
                
                // 日期資料
                const days = ref([
                    { id: 1, dayOfWeek: 'Wed', date: '29', month: 'Jul', location: '愛丁堡' },
                    { id: 2, dayOfWeek: 'Thu', date: '30', month: 'Jul', location: '愛丁堡' },
                    { id: 3, dayOfWeek: 'Fri', date: '31', month: 'Jul', location: '愛丁堡' },
                    { id: 4, dayOfWeek: 'Sat', date: '1', month: 'Aug', location: '高地與斯凱島' },
                    { id: 5, dayOfWeek: 'Sun', date: '2', month: 'Aug', location: '斯凱島' },
                    { id: 6, dayOfWeek: 'Mon', date: '3', month: 'Aug', location: '返回愛丁堡' },
                    { id: 7, dayOfWeek: 'Tue', date: '4', month: 'Aug', location: '格拉斯哥' },
                    { id: 8, dayOfWeek: 'Wed', date: '5', month: 'Aug', location: '格拉斯哥' },
                    { id: 9, dayOfWeek: 'Thu', date: '6', month: 'Aug', location: '湖區' },
                    { id: 10, dayOfWeek: 'Fri', date: '7', month: 'Aug', location: '湖區' },
                    { id: 11, dayOfWeek: 'Sat', date: '8', month: 'Aug', location: '利物浦' },
                    { id: 12, dayOfWeek: 'Sun', date: '9', month: 'Aug', location: '利物浦' },
                    { id: 13, dayOfWeek: 'Mon', date: '10', month: 'Aug', location: '切斯特' },
                    { id: 14, dayOfWeek: 'Tue', date: '11', month: 'Aug', location: '切斯特' },
                    { id: 15, dayOfWeek: 'Wed', date: '12', month: 'Aug', location: '曼徹斯特' },
                    { id: 16, dayOfWeek: 'Thu', date: '13', month: 'Aug', location: '曼徹斯特' }
                ]);
                
                // 行程分類
                const categories = ref([
                    { id: 'attraction', name: '景點' },
                    { id: 'accommodation', name: '住宿' },
                    { id: 'food', name: '美食' },
                    { id: 'shopping', name: '購物' },
                    { id: 'flight', name: '航班' },
                    { id: 'other', name: '其他' }
                ]);
                
                // 天氣資料
                const weatherData = ref({});
                
                // 行程資料 (初始化為您的行程資料)
                const itineraryItems = ref([]);
                
                // 購物清單
                const shoppingList = ref([]);
                
                // 花費記錄
                const expenses = ref([]);
                
                // 匯率換算
                const gbpAmount = ref(100);
                const exchangeRate = ref(10.5); // 1 GBP = 10.5 HKD
                const exchangeRateDate = ref('2026-07-28');
                
                // 表單數據
                const itineraryForm = ref({
                    title: '',
                    category: 'attraction',
                    time: '',
                    openingHours: '',
                    ticketPrice: '',
                    notes: '',
                    transportType: 'walk',
                    transportTime: '',
                    location: ''
                });
                
                const shoppingForm = ref({
                    name: '',
                    image: '',
                    notes: ''
                });
                
                const expenseForm = ref({
                    category: 'transport',
                    name: '',
                    date: new Date().toISOString().split('T')[0],
                    amount: 0,
                    paymentMethod: '現金',
                    notes: ''
                });
                
                // 拖放排序相關
                const draggedItemIndex = ref(null);
                
                // 計算屬性
                const calculatedHKD = computed(() => {
                    return (gbpAmount.value * exchangeRate.value).toFixed(2);
                });
                
                const totalExpenses = computed(() => {
                    return expenses.value.reduce((sum, expense) => sum + parseFloat(expense.amount || 0), 0).toFixed(2);
                });
                
                const filteredItineraryItems = computed(() => {
                    let filtered = itineraryItems.value.filter(item => item.day === selectedDay.value);
                    
                    if (categoryFilter.value.length > 0) {
                        filtered = filtered.filter(item => categoryFilter.value.includes(item.category));
                    }
                    
                    return filtered.sort((a, b) => {
                        // 根據時間排序
                        const timeA = a.time ? parseInt(a.time.split(':')[0]) : 0;
                        const timeB = b.time ? parseInt(b.time.split(':')[0]) : 0;
                        return timeA - timeB;
                    });
                });
                
                // 方法
                const selectDay = (dayId) => {
                    selectedDay.value = dayId;
                    // 載入該日的天氣
                    loadWeatherForDay(dayId);
                };
                
                const getDayLocation = (dayId) => {
                    const day = days.value.find(d => d.id === dayId);
                    return day ? day.location : '未知地點';
                };
                
                const loadWeatherForDay = async (dayId) => {
                    // 如果已經有該日的天氣資料，直接返回
                    if (weatherData.value[dayId]) return;
                    
                    const location = getDayLocation(dayId);
                    const cityMap = {
                        '愛丁堡': 'Edinburgh',
                        '格拉斯哥': 'Glasgow',
                        '湖區': 'Windermere',
                        '利物浦': 'Liverpool',
                        '切斯特': 'Chester',
                        '曼徹斯特': 'Manchester',
                        '高地與斯凱島': 'Isle of Skye',
                        '斯凱島': 'Isle of Skye',
                        '返回愛丁堡': 'Edinburgh'
                    };
                    
                    const city = cityMap[location] || 'London';
                    
                    try {
                        // 這裡使用模擬的天氣資料，實際應用中應該連接天氣API
                        // 由於瀏覽器限制，這裡使用模擬數據
                        const mockWeather = {
                            1: { temp: 18, feelsLike: 17, condition: '晴天', humidity: 65, windSpeed: 12, icon: 'fas fa-sun' },
                            2: { temp: 16, feelsLike: 15, condition: '多雲', humidity: 70, windSpeed: 10, icon: 'fas fa-cloud' },
                            3: { temp: 15, feelsLike: 14, condition: '小雨', humidity: 80, windSpeed: 8, icon: 'fas fa-cloud-rain' },
                            4: { temp: 14, feelsLike: 13, condition: '多雲', humidity: 75, windSpeed: 15, icon: 'fas fa-cloud' },
                            5: { temp: 13, feelsLike: 12, condition: '陰天', humidity: 85, windSpeed: 20, icon: 'fas fa-cloud' },
                            6: { temp: 16, feelsLike: 15, condition: '多雲', humidity: 70, windSpeed: 12, icon: 'fas fa-cloud' },
                            7: { temp: 17, feelsLike: 16, condition: '晴天', humidity: 65, windSpeed: 10, icon: 'fas fa-sun' },
                            8: { temp: 18, feelsLike: 17, condition: '晴天', humidity: 60, windSpeed: 8, icon: 'fas fa-sun' },
                            9: { temp: 16, feelsLike: 15, condition: '多雲', humidity: 75, windSpeed: 12, icon: 'fas fa-cloud' },
                            10: { temp: 15, feelsLike: 14, condition: '小雨', humidity: 80, windSpeed: 10, icon: 'fas fa-cloud-rain' },
                            11: { temp: 17, feelsLike: 16, condition: '多雲', humidity: 70, windSpeed: 12, icon: 'fas fa-cloud' },
                            12: { temp: 18, feelsLike: 17, condition: '晴天', humidity: 65, windSpeed: 10, icon: 'fas fa-sun' },
                            13: { temp: 19, feelsLike: 18, condition: '晴天', humidity: 60, windSpeed: 8, icon: 'fas fa-sun' },
                            14: { temp: 20, feelsLike: 19, condition: '晴天', humidity: 55, windSpeed: 6, icon: 'fas fa-sun' },
                            15: { temp: 19, feelsLike: 18, condition: '多雲', humidity: 65, windSpeed: 10, icon: 'fas fa-cloud' },
                            16: { temp: 18, feelsLike: 17, condition: '小雨', humidity: 75, windSpeed: 12, icon: 'fas fa-cloud-rain' }
                        };
                        
                        weatherData.value[dayId] = mockWeather[dayId] || { 
                            temp: 17, 
                            feelsLike: 16, 
                            condition: '多雲', 
                            humidity: 70, 
                            windSpeed: 10, 
                            icon: 'fas fa-cloud' 
                        };
                    } catch (error) {
                        console.error('載入天氣資料失敗:', error);
                        weatherData.value[dayId] = { 
                            temp: '--', 
                            feelsLike: '--', 
                            condition: '資料載入失敗', 
                            humidity: '--', 
                            windSpeed: '--', 
                            icon: 'fas fa-exclamation-triangle' 
                        };
                    }
                };
                
                const toggleCategoryFilter = (categoryId) => {
                    const index = categoryFilter.value.indexOf(categoryId);
                    if (index === -1) {
                        categoryFilter.value.push(categoryId);
                    } else {
                        categoryFilter.value.splice(index, 1);
                    }
                };
                
                const getCategoryClass = (categoryId, isActive) => {
                    const baseClass = "flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium";
                    
                    if (!isActive) {
                        return `${baseClass} bg-gray-100 text-gray-700`;
                    }
                    
                    switch(categoryId) {
                        case 'attraction': return `${baseClass} bg-blue-100 text-blue-800`;
                        case 'accommodation': return `${baseClass} bg-green-100 text-green-800`;
                        case 'food': return `${baseClass} bg-yellow-100 text-yellow-800`;
                        case 'shopping': return `${baseClass} bg-pink-100 text-pink-800`;
                        case 'flight': return `${baseClass} bg-indigo-100 text-indigo-800`;
                        case 'other': return `${baseClass} bg-gray-200 text-gray-800`;
                        default: return `${baseClass} bg-gray-100 text-gray-700`;
                    }
                };
                
                const getCategoryBadgeClass = (category) => {
                    switch(category) {
                        case 'attraction': return 'category-badge category-attraction';
                        case 'accommodation': return 'category-badge category-accommodation';
                        case 'food': return 'category-badge category-food';
                        case 'shopping': return 'category-badge category-shopping';
                        case 'flight': return 'category-badge category-flight';
                        case 'other': return 'category-badge category-other';
                        default: return 'category-badge category-other';
                    }
                };
                
                const getCategoryName = (category) => {
                    const categoryObj = categories.value.find(c => c.id === category);
                    return categoryObj ? categoryObj.name : '其他';
                };
                
                const getTransportClass = (transportType) => {
                    switch(transportType) {
                        case 'walk': return 'transport-walk';
                        case 'drive': return 'transport-drive';
                        case 'transit': return 'transport-transit';
                        default: return 'transport-walk';
                    }
                };
                
                const getTransportIcon = (transportType) => {
                    switch(transportType) {
                        case 'walk': return 'fas fa-walking';
                        case 'drive': return 'fas fa-car';
                        case 'transit': return 'fas fa-bus';
                        default: return 'fas fa-walking';
                    }
                };
                
                const getExpenseCategoryClass = (category) => {
                    switch(category) {
                        case 'transport': return 'category-badge category-attraction';
                        case 'food': return 'category-badge category-food';
                        case 'accommodation': return 'category-badge category-accommodation';
                        case 'ticket': return 'category-badge category-flight';
                        case 'shopping': return 'category-badge category-shopping';
                        case 'other': return 'category-badge category-other';
                        default: return 'category-badge category-other';
                    }
                };
                
                const getExpenseCategoryName = (category) => {
                    switch(category) {
                        case 'transport': return '交通';
                        case 'food': return '飲食';
                        case 'accommodation': return '住宿';
                        case 'ticket': return '門票';
                        case 'shopping': return '購物';
                        case 'other': return '其他';
                        default: return '其他';
                    }
                };
                
                const openGoogleMaps = (location, title) => {
                    // 編碼地點名稱
                    const encodedLocation = encodeURIComponent(location + ', UK');
                    // 開啟 Google Maps
                    window.open(`https://www.google.com/maps/search/?api=1&query=${encodedLocation}`, '_blank');
                };
                
                const callEmergency = (number) => {
                    if (confirm(`確定要撥打緊急電話 ${number} 嗎？`)) {
                        window.location.href = `tel:${number}`;
                    }
                };
                
                const handleFABClick = () => {
                    switch(currentTab.value) {
                        case 'itinerary':
                            openItineraryModal();
                            break;
                        case 'shopping':
                            openShoppingModal();
                            break;
                        case 'expenses':
                            openExpenseModal();
                            break;
                    }
                };
                
                const openItineraryModal = (item = null) => {
                    if (item) {
                        editingItineraryItem.value = item;
                        itineraryForm.value = { ...item };
                    } else {
                        editingItineraryItem.value = null;
                        itineraryForm.value = {
                            title: '',
                            category: 'attraction',
                            time: '',
                            openingHours: '',
                            ticketPrice: '',
                            notes: '',
                            transportType: 'walk',
                            transportTime: '',
                            location: ''
                        };
                    }
                    showItineraryModal.value = true;
                };
                
                const closeItineraryModal = () => {
                    showItineraryModal.value = false;
                    editingItineraryItem.value = null;
                };
                
                const saveItineraryItem = async () => {
                    if (!itineraryForm.value.title.trim()) {
                        alert('請輸入行程名稱');
                        return;
                    }
                    
                    if (!itineraryForm.value.location.trim()) {
                        alert('請輸入地點（用於Google Maps導航）');
                        return;
                    }
                    
                    try {
                        if (editingItineraryItem.value) {
                            // 更新現有項目
                            const index = itineraryItems.value.findIndex(item => item.id === editingItineraryItem.value.id);
                            if (index !== -1) {
                                itineraryItems.value[index] = {
                                    ...itineraryForm.value,
                                    id: editingItineraryItem.value.id,
                                    day: selectedDay.value
                                };
                            }
                        } else {
                            // 新增項目
                            const newId = itineraryItems.value.length > 0 ? Math.max(...itineraryItems.value.map(item => item.id)) + 1 : 1;
                            itineraryItems.value.push({
                                ...itineraryForm.value,
                                id: newId,
                                day: selectedDay.value
                            });
                        }
                        
                        // 儲存到本地儲存
                        saveToLocalStorage();
                        // 同步到 Firebase
                        await syncToFirebase();
                        
                        closeItineraryModal();
                    } catch (error) {
                        console.error('儲存行程失敗:', error);
                        alert('儲存失敗，請稍後再試');
                    }
                };
                
                const confirmDeleteItineraryItem = () => {
                    showDeleteConfirmModal.value = true;
                };
                
                const deleteItineraryItem = async () => {
                    try {
                        const index = itineraryItems.value.findIndex(item => item.id === editingItineraryItem.value.id);
                        if (index !== -1) {
                            itineraryItems.value.splice(index, 1);
                        }
                        
                        // 儲存到本地儲存
                        saveToLocalStorage();
                        // 同步到 Firebase
                        await syncToFirebase();
                        
                        showDeleteConfirmModal.value = false;
                        closeItineraryModal();
                    } catch (error) {
                        console.error('刪除行程失敗:', error);
                        alert('刪除失敗，請稍後再試');
                    }
                };
                
                const editItineraryItem = (item) => {
                    openItineraryModal(item);
                };
                
                const dragStart = (index) => {
                    draggedItemIndex.value = index;
                };
                
                const dragOver = (index) => {
                    // 防止預設行為以允許拖放
                };
                
                const drop = async (index) => {
                    if (draggedItemIndex.value === null || draggedItemIndex.value === index) return;
                    
                    // 重新排序項目
                    const items = filteredItineraryItems.value;
                    const draggedItem = items[draggedItemIndex.value];
                    
                    // 從原位置移除
                    items.splice(draggedItemIndex.value, 1);
                    // 插入到新位置
                    items.splice(index, 0, draggedItem);
                    
                    // 更新原始數組
                    const dayItems = items;
                    const otherItems = itineraryItems.value.filter(item => item.day !== selectedDay.value);
                    
                    // 重新賦值
                    itineraryItems.value = [...otherItems, ...dayItems];
                    
                    // 儲存到本地儲存
                    saveToLocalStorage();
                    // 同步到 Firebase
                    await syncToFirebase();
                    
                    draggedItemIndex.value = null;
                };
                
                const openShoppingModal = () => {
                    shoppingForm.value = {
                        name: '',
                        image: '',
                        notes: ''
                    };
                    showShoppingModal.value = true;
                };
                
                const closeShoppingModal = () => {
                    showShoppingModal.value = false;
                };
                
                const saveShoppingItem = async () => {
                    if (!shoppingForm.value.name.trim()) {
                        alert('請輸入商品名稱');
                        return;
                    }
                    
                    try {
                        const newId = shoppingList.value.length > 0 ? Math.max(...shoppingList.value.map(item => item.id)) + 1 : 1;
                        shoppingList.value.push({
                            ...shoppingForm.value,
                            id: newId,
                            addedDate: new Date().toISOString().split('T')[0]
                        });
                        
                        // 儲存到本地儲存
                        saveToLocalStorage();
                        // 同步到 Firebase
                        await syncToFirebase();
                        
                        closeShoppingModal();
                    } catch (error) {
                        console.error('儲存購物項目失敗:', error);
                        alert('儲存失敗，請稍後再試');
                    }
                };
                
                const removeShoppingItem = async (id) => {
                    if (confirm('確定要刪除這個購物項目嗎？')) {
                        try {
                            const index = shoppingList.value.findIndex(item => item.id === id);
                            if (index !== -1) {
                                shoppingList.value.splice(index, 1);
                            }
                            
                            // 儲存到本地儲存
                            saveToLocalStorage();
                            // 同步到 Firebase
                            await syncToFirebase();
                        } catch (error) {
                            console.error('刪除購物項目失敗:', error);
                            alert('刪除失敗，請稍後再試');
                        }
                    }
                };
                
                const openExpenseModal = () => {
                    expenseForm.value = {
                        category: 'transport',
                        name: '',
                        date: new Date().toISOString().split('T')[0],
                        amount: 0,
                        paymentMethod: '現金',
                        notes: ''
                    };
                    showExpenseModal.value = true;
                };
                
                const closeExpenseModal = () => {
                    showExpenseModal.value = false;
                };
                
                const saveExpense = async () => {
                    if (!expenseForm.value.name.trim()) {
                        alert('請輸入花費項目名稱');
                        return;
                    }
                    
                    if (!expenseForm.value.amount || expenseForm.value.amount <= 0) {
                        alert('請輸入正確的金額');
                        return;
                    }
                    
                    try {
                        const newId = expenses.value.length > 0 ? Math.max(...expenses.value.map(item => item.id)) + 1 : 1;
                        expenses.value.push({
                            ...expenseForm.value,
                            id: newId,
                            amount: parseFloat(expenseForm.value.amount)
                        });
                        
                        // 儲存到本地儲存
                        saveToLocalStorage();
                        // 同步到 Firebase
                        await syncToFirebase();
                        
                        closeExpenseModal();
                    } catch (error) {
                        console.error('儲存花費記錄失敗:', error);
                        alert('儲存失敗，請稍後再試');
                    }
                };
                
                // 本地儲存功能
                const saveToLocalStorage = () => {
                    try {
                        const data = {
                            itineraryItems: itineraryItems.value,
                            shoppingList: shoppingList.value,
                            expenses: expenses.value,
                            lastUpdated: new Date().toISOString()
                        };
                        localStorage.setItem('ukTravelItinerary', JSON.stringify(data));
                        console.log('資料已儲存到本地儲存');
                    } catch (error) {
                        console.error('本地儲存失敗:', error);
                    }
                };
                
                const loadFromLocalStorage = () => {
                    try {
                        const savedData = localStorage.getItem('ukTravelItinerary');
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            itineraryItems.value = data.itineraryItems || [];
                            shoppingList.value = data.shoppingList || [];
                            expenses.value = data.expenses || [];
                            console.log('從本地儲存載入資料成功');
                        }
                    } catch (error) {
                        console.error('從本地儲存載入資料失敗:', error);
                    }
                };
                
                // Firebase 同步功能
                const syncToFirebase = async () => {
                    if (!database) {
                        console.log('Firebase 未初始化，跳過同步');
                        return;
                    }
                    
                    try {
                        showSyncIndicator.value = true;
                        syncStatus.value = 'syncing';
                        syncMessage.value = '同步中...';
                        
                        const data = {
                            itineraryItems: itineraryItems.value,
                            shoppingList: shoppingList.value,
                            expenses: expenses.value,
                            lastUpdated: new Date().toISOString(),
                            updatedBy: 'user_' + Math.random().toString(36).substr(2, 9)
                        };
                        
                        await database.ref('travelData').set(data);
                        
                        syncStatus.value = 'synced';
                        syncMessage.value = '已同步';
                        
                        // 3秒後隱藏同步指示器
                        setTimeout(() => {
                            showSyncIndicator.value = false;
                        }, 3000);
                        
                        console.log('資料已同步到 Firebase');
                    } catch (error) {
                        console.error('Firebase 同步失敗:', error);
                        syncStatus.value = 'error';
                        syncMessage.value = '同步失敗';
                        
                        // 5秒後隱藏同步指示器
                        setTimeout(() => {
                            showSyncIndicator.value = false;
                        }, 5000);
                    }
                };
                
                const loadFromFirebase = async () => {
                    if (!database) {
                        console.log('Firebase 未初始化，從本地儲存載入');
                        loadFromLocalStorage();
                        return;
                    }
                    
                    try {
                        showSyncIndicator.value = true;
                        syncStatus.value = 'syncing';
                        syncMessage.value = '載入資料中...';
                        
                        const snapshot = await database.ref('travelData').once('value');
                        const data = snapshot.val();
                        
                        if (data) {
                            itineraryItems.value = data.itineraryItems || [];
                            shoppingList.value = data.shoppingList || [];
                            expenses.value = data.expenses || [];
                            console.log('從 Firebase 載入資料成功');
                            
                            // 也儲存到本地儲存作為備份
                            saveToLocalStorage();
                        } else {
                            // Firebase 沒有資料，從本地儲存載入
                            loadFromLocalStorage();
                        }
                        
                        syncStatus.value = 'synced';
                        syncMessage.value = '資料已載入';
                        
                        // 3秒後隱藏同步指示器
                        setTimeout(() => {
                            showSyncIndicator.value = false;
                        }, 3000);
                    } catch (error) {
                        console.error('從 Firebase 載入資料失敗:', error);
                        syncStatus.value = 'error';
                        syncMessage.value = '載入失敗，使用本地資料';
                        
                        // 從本地儲存載入
                        loadFromLocalStorage();
                        
                        // 5秒後隱藏同步指示器
                        setTimeout(() => {
                            showSyncIndicator.value = false;
                        }, 5000);
                    }
                };
                
                // 監聽 Firebase 資料變化（即時同步）
                const setupFirebaseListener = () => {
                    if (!database) return;
                    
                    database.ref('travelData').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            // 檢查是否為當前用戶的更新，避免重複處理
                            const currentData = {
                                itineraryItems: itineraryItems.value,
                                shoppingList: shoppingList.value,
                                expenses: expenses.value
                            };
                            
                            // 簡單比較，避免過度更新
                            if (JSON.stringify(currentData) !== JSON.stringify({
                                itineraryItems: data.itineraryItems || [],
                                shoppingList: data.shoppingList || [],
                                expenses: data.expenses || []
                            })) {
                                console.log('收到 Firebase 更新');
                                itineraryItems.value = data.itineraryItems || [];
                                shoppingList.value = data.shoppingList || [];
                                expenses.value = data.expenses || [];
                                
                                // 更新本地儲存
                                saveToLocalStorage();
                                
                                // 顯示同步通知
                                showSyncIndicator.value = true;
                                syncStatus.value = 'synced';
                                syncMessage.value = '資料已更新';
                                
                                setTimeout(() => {
                                    showSyncIndicator.value = false;
                                }, 3000);
                            }
                        }
                    });
                };
                
                // 初始化預設行程資料（根據您提供的資料）
                const initDefaultItinerary = () => {
                    // 如果已經有資料，不初始化
                    if (itineraryItems.value.length > 0) return;
                    
                    const defaultItinerary = [
                        // 第一天
                        {
                            id: 1,
                            day: 1,
                            category: 'flight',
                            title: '香港 → 蘇黎世 → 愛丁堡',
                            fromCode: 'HKG',
                            toCode: 'EDI',
                            flightNumber: 'LX139 + LX8290',
                            departureTime: '28 Jul 2026, 23:15',
                            arrivalTime: '29 Jul 2026, 08:40',
                            airline: 'SWISS + Edelweiss Air',
                            time: '08:40',
                            location: 'Edinburgh Airport, UK',
                            notes: '抵達愛丁堡機場'
                        },
                        {
                            id: 2,
                            day: 1,
                            category: 'transport',
                            title: '愛丁堡機場 → 市區',
                            time: '09:00-09:30',
                            openingHours: '',
                            ticketPrice: '£6.5/人',
                            notes: 'Airlink 100巴士，30分鐘',
                            transportType: 'transit',
                            transportTime: '30分鐘',
                            location: 'Edinburgh Airport Bus Station'
                        },
                        {
                            id: 3,
                            day: 1,
                            category: 'accommodation',
                            title: '酒店寄存行李',
                            time: '09:35-10:00',
                            openingHours: '',
                            ticketPrice: '',
                            notes: '酒店寄存行李',
                            transportType: 'walk',
                            transportTime: '5分鐘',
                            location: 'Edinburgh City Centre'
                        },
                        {
                            id: 4,
                            day: 1,
                            category: 'attraction',
                            title: '老城徒步',
                            time: '10:00-18:00',
                            openingHours: '',
                            ticketPrice: '免費',
                            notes: 'Castlehill→維多利亞街→聖吉爾斯大教堂→皇家一英里→Grassmarket',
                            transportType: 'walk',
                            transportTime: '步行遊覽',
                            location: 'Royal Mile, Edinburgh'
                        },
                        {
                            id: 5,
                            day: 1,
                            category: 'food',
                            title: '晚餐',
                            time: '18:00-20:00',
                            openingHours: '',
                            ticketPrice: '',
                            notes: '愛丁堡當地餐廳',
                            transportType: 'walk',
                            transportTime: '10分鐘',
                            location: 'Restaurants Edinburgh Old Town'
                        },
                        // 第二天
                        {
                            id: 6,
                            day: 2,
                            category: 'attraction',
                            title: '愛丁堡城堡',
                            time: '09:00-12:00',
                            openingHours: '09:30-18:00',
                            ticketPrice: '£18/人',
                            notes: '需預約',
                            transportType: 'walk',
                            transportTime: '15分鐘',
                            location: 'Edinburgh Castle'
                        },
                        {
                            id: 7,
                            day: 2,
                            category: 'attraction',
                            title: '皇家遊艇不列顛尼亞號',
                            time: '12:30-14:30',
                            openingHours: '10:00-17:00',
                            ticketPrice: '£12/人',
                            notes: '巴士前往',
                            transportType: 'transit',
                            transportTime: '30分鐘',
                            location: 'The Royal Yacht Britannia, Edinburgh'
                        },
                        {
                            id: 8,
                            day: 2,
                            category: 'attraction',
                            title: '愛丁堡皇家植物園',
                            time: '15:00-16:30',
                            openingHours: '10:00-18:00',
                            ticketPrice: '免費，溫室£2.5/人',
                            notes: '',
                            transportType: 'transit',
                            transportTime: '20分鐘',
                            location: 'Royal Botanic Garden Edinburgh'
                        },
                        {
                            id: 9,
                            day: 2,
                            category: 'attraction',
                            title: 'Dean Village',
                            time: '17:00-18:00',
                            openingHours: '',
                            ticketPrice: '免費',
                            notes: '步行25分鐘',
                            transportType: 'walk',
                            transportTime: '25分鐘',
                            location: 'Dean Village, Edinburgh'
                        },
                        // 第三天
                        {
                            id: 10,
                            day: 3,
                            category: 'attraction',
                            title: '卡爾頓山',
                            time: '09:00-10:00',
                            openingHours: '',
                            ticketPrice: '免費',
                            notes: '',
                            transportType: 'walk',
                            transportTime: '15分鐘',
                            location: 'Calton Hill, Edinburgh'
                        },
                        {
                            id: 11,
                            day: 3,
                            category: 'attraction',
                            title: '蘇格蘭國立博物館',
                            time: '10:30-12:30',
                            openingHours: '10:00-17:00',
                            ticketPrice: '免費',
                            notes: '',
                            transportType: 'walk',
                            transportTime: '20分鐘',
                            location: 'National Museum of Scotland'
                        },
                        {
                            id: 12,
                            day: 3,
                            category: 'attraction',
                            title: '蘇格蘭國家畫廊',
                            time: '13:30-15:00',
                            openingHours: '10:00-17:00',
                            ticketPrice: '免費',
                            notes: '',
                            transportType: 'walk',
                            transportTime: '10分鐘',
                            location: 'Scottish National Gallery'
                        },
                        {
                            id: 13,
                            day: 3,
                            category: 'attraction',
                            title: '蘇格蘭威士忌體驗中心',
                            time: '15:30-16:30',
                            openingHours: '10:00-17:00',
                            ticketPrice: '£15/人',
                            notes: '',
                            transportType: 'walk',
                            transportTime: '15分鐘',
                            location: 'The Scotch Whisky Experience, Edinburgh'
                        }
                    ];
                    
                    itineraryItems.value = defaultItinerary;
                };
                
                // 初始化
                onMounted(async () => {
                    console.log('應用已載入');
                    
                    // 載入資料
                    await loadFromFirebase();
                    
                    // 初始化預設行程
                    initDefaultItinerary();
                    
                    // 載入第一天的天氣
                    loadWeatherForDay(1);
                    
                    // 設定 Firebase 監聽器
                    setupFirebaseListener();
                    
                    // 自動保存到本地儲存
                    setInterval(() => {
                        saveToLocalStorage();
                    }, 30000); // 每30秒自動保存
                    
                    // 每5分鐘同步到 Firebase
                    setInterval(async () => {
                        await syncToFirebase();
                    }, 300000);
                });
                
                return {
                    currentTab,
                    selectedDay,
                    categoryFilter,
                    showItineraryModal,
                    showShoppingModal,
                    showExpenseModal,
                    showDeleteConfirmModal,
                    showFAB,
                    editingItineraryItem,
                    days,
                    categories,
                    itineraryItems,
                    shoppingList,
                    expenses,
                    gbpAmount,
                    exchangeRate,
                    exchangeRateDate,
                    itineraryForm,
                    shoppingForm,
                    expenseForm,
                    weatherData,
                    syncStatus,
                    syncMessage,
                    showSyncIndicator,
                    syncIcon,
                    calculatedHKD,
                    totalExpenses,
                    filteredItineraryItems,
                    selectDay,
                    getDayLocation,
                    toggleCategoryFilter,
                    getCategoryClass,
                    getCategoryBadgeClass,
                    getCategoryName,
                    getTransportClass,
                    getTransportIcon,
                    getExpenseCategoryClass,
                    getExpenseCategoryName,
                    openGoogleMaps,
                    callEmergency,
                    handleFABClick,
                    openItineraryModal,
                    closeItineraryModal,
                    saveItineraryItem,
                    confirmDeleteItineraryItem,
                    deleteItineraryItem,
                    editItineraryItem,
                    dragStart,
                    dragOver,
                    drop,
                    openShoppingModal,
                    closeShoppingModal,
                    saveShoppingItem,
                    removeShoppingItem,
                    openExpenseModal,
                    closeExpenseModal,
                    saveExpense
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
