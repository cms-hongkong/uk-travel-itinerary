<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英倫風旅行行程管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/vue3-simple-typeahead@1.0.5/dist/vue3-simple-typeahead.css" />
    <style>
        :root {
            --primary-british: #1E3A8A; /* 英國皇家藍 */
            --secondary-british: #B91C1C; /* 英國紅 */
            --accent-british: #047857; /* 英國綠 */
            --light-british: #FEF3C7; /* 淺米色 */
            --dark-british: #0F172A; /* 深藍黑 */
        }
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .playfair-display {
            font-family: 'Playfair Display', serif;
        }
        
        body {
            background-color: #f8f9fa;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            position: relative;
        }
        
        .tab-active {
            color: var(--primary-british);
            border-bottom: 3px solid var(--primary-british);
        }
        
        .card-shadow {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .british-gradient {
            background: linear-gradient(135deg, var(--primary-british) 0%, var(--accent-british) 100%);
        }
        
        .header-image {
            height: 250px;
            background-image: url('https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80');
            background-size: cover;
            background-position: center;
            position: relative;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
        }
        
        .header-overlay {
            background: linear-gradient(to bottom, rgba(30, 58, 138, 0.2), rgba(30, 58, 138, 0.5));
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
        }
        
        .tab-container {
            margin-top: -40px;
            z-index: 10;
            position: relative;
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-british);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
            z-index: 100;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            background-color: var(--secondary-british);
        }
        
        .day-selector::-webkit-scrollbar {
            height: 6px;
        }
        
        .day-selector::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .day-selector::-webkit-scrollbar-thumb {
            background: var(--primary-british);
            border-radius: 10px;
        }
        
        .drag-handle {
            cursor: move;
        }
        
        .weather-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .flight-card {
            background: linear-gradient(135deg, #0F172A 0%, #1E3A8A 100%);
            color: white;
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .category-attraction {
            background-color: #DBEAFE;
            color: var(--primary-british);
        }
        
        .category-accommodation {
            background-color: #D1FAE5;
            color: var(--accent-british);
        }
        
        .category-food {
            background-color: #FEF3C7;
            color: #B45309;
        }
        
        .category-shopping {
            background-color: #FCE7F3;
            color: #BE185D;
        }
        
        .category-flight {
            background-color: #E0E7FF;
            color: #3730A3;
        }
        
        .category-other {
            background-color: #F3F4F6;
            color: #4B5563;
        }
        
        .transport-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        
        .transport-walk {
            background-color: #10B981;
            color: white;
        }
        
        .transport-drive {
            background-color: #3B82F6;
            color: white;
        }
        
        .transport-transit {
            background-color: #8B5CF6;
            color: white;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 頁首 -->
        <header class="header-image">
            <div class="header-overlay"></div>
            <div class="absolute top-5 left-5 text-white">
                <h1 class="playfair-display text-3xl font-bold">英倫之旅</h1>
                <p class="text-sm mt-1">2026年7月29日 - 8月13日</p>
            </div>
            
            <!-- Tab導航按鈕 -->
            <div class="tab-container flex justify-end px-5 space-x-6">
                <button 
                    @click="currentTab = 'itinerary'" 
                    :class="{'tab-active': currentTab === 'itinerary'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-map-marker-alt text-xl"></i>
                    <span class="text-xs mt-1">行程</span>
                </button>
                <button 
                    @click="currentTab = 'info'" 
                    :class="{'tab-active': currentTab === 'info'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-info-circle text-xl"></i>
                    <span class="text-xs mt-1">資訊</span>
                </button>
                <button 
                    @click="currentTab = 'shopping'" 
                    :class="{'tab-active': currentTab === 'shopping'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-shopping-basket text-xl"></i>
                    <span class="text-xs mt-1">購物</span>
                </button>
                <button 
                    @click="currentTab = 'expenses'" 
                    :class="{'tab-active': currentTab === 'expenses'}"
                    class="pb-2 flex flex-col items-center text-white"
                >
                    <i class="fas fa-money-bill-wave text-xl"></i>
                    <span class="text-xs mt-1">花費</span>
                </button>
            </div>
        </header>

        <!-- 主要內容區域 -->
        <main class="px-5 pb-24 -mt-6">
            <!-- 行程頁面 -->
            <div v-if="currentTab === 'itinerary'" class="space-y-6">
                <!-- 日期選擇器 -->
                <div class="day-selector flex space-x-4 overflow-x-auto py-2">
                    <div 
                        v-for="day in days" 
                        :key="day.id"
                        @click="selectDay(day.id)"
                        :class="{'bg-blue-50 border border-blue-200': selectedDay === day.id}"
                        class="flex-shrink-0 w-16 p-3 rounded-xl text-center cursor-pointer hover:bg-blue-50 transition-colors"
                    >
                        <div class="text-sm font-semibold text-blue-800">{{ day.dayOfWeek }}</div>
                        <div class="text-2xl font-bold text-gray-800">{{ day.date }}</div>
                        <div class="text-xs text-gray-500 mt-1">{{ day.month }}</div>
                    </div>
                </div>
                
                <!-- 天氣資訊（僅在第一天顯示示例） -->
                <div v-if="selectedDay === 1" class="weather-card rounded-2xl p-5 card-shadow">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-lg">愛丁堡天氣</h3>
                            <div class="flex items-center mt-2">
                                <i class="fas fa-sun text-3xl mr-4"></i>
                                <div>
                                    <div class="text-3xl font-bold">18°C</div>
                                    <div class="text-sm opacity-90">體感溫度: 17°C</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">晴天</div>
                            <div class="text-sm mt-2">濕度: 65%</div>
                            <div class="text-sm">風速: 12 km/h</div>
                        </div>
                    </div>
                </div>
                
                <!-- 行程分類篩選 -->
                <div class="flex space-x-2 overflow-x-auto py-2">
                    <button 
                        v-for="category in categories" 
                        :key="category.id"
                        @click="toggleCategoryFilter(category.id)"
                        :class="getCategoryClass(category.id, categoryFilter.includes(category.id))"
                        class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium"
                    >
                        {{ category.name }}
                    </button>
                </div>
                
                <!-- 行程列表 -->
                <div class="space-y-6">
                    <div 
                        v-for="(item, index) in filteredItineraryItems" 
                        :key="item.id"
                        class="bg-white rounded-2xl p-5 card-shadow"
                        :draggable="true"
                        @dragstart="dragStart(index)"
                        @dragover.prevent="dragOver(index)"
                        @drop="drop(index)"
                    >
                        <!-- 航班資訊卡片（特殊樣式） -->
                        <div v-if="item.category === 'flight'" class="flight-card rounded-2xl p-5">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-xl font-bold">{{ item.title }}</div>
                                    <div class="flex items-center mt-2">
                                        <div class="text-2xl font-bold">{{ item.fromCode }}</div>
                                        <div class="mx-3">
                                            <i class="fas fa-plane"></i>
                                        </div>
                                        <div class="text-2xl font-bold">{{ item.toCode }}</div>
                                    </div>
                                    <div class="mt-3 text-sm opacity-90">
                                        <div>航班: {{ item.flightNumber }}</div>
                                        <div>出發: {{ item.departureTime }}</div>
                                        <div>抵達: {{ item.arrivalTime }}</div>
                                        <div>航空公司: {{ item.airline }}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="category-badge category-flight">{{ getCategoryName('flight') }}</span>
                                </div>
                            </div>
                            <button 
                                @click="navigateTo(item.location)"
                                class="mt-4 w-full bg-white text-blue-900 py-2 rounded-lg font-semibold flex items-center justify-center"
                            >
                                <i class="fas fa-map-marked-alt mr-2"></i> 開始導航
                            </button>
                        </div>
                        
                        <!-- 一般行程卡片 -->
                        <div v-else>
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center">
                                        <i class="fas fa-grip-vertical text-gray-400 mr-3 drag-handle"></i>
                                        <div>
                                            <div class="flex items-center">
                                                <span class="category-badge" :class="getCategoryBadgeClass(item.category)">
                                                    {{ getCategoryName(item.category) }}
                                                </span>
                                                <span class="ml-3 text-sm text-gray-500">{{ item.time }}</span>
                                            </div>
                                            <h3 class="text-xl font-bold mt-2">{{ item.title }}</h3>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 space-y-2">
                                        <div v-if="item.openingHours" class="flex items-center text-gray-700">
                                            <i class="far fa-clock w-5 mr-2"></i>
                                            <span>{{ item.openingHours }}</span>
                                        </div>
                                        <div v-if="item.ticketPrice" class="flex items-center text-gray-700">
                                            <i class="fas fa-ticket-alt w-5 mr-2"></i>
                                            <span>{{ item.ticketPrice }}</span>
                                        </div>
                                        <div v-if="item.notes" class="text-gray-700">
                                            <i class="fas fa-star w-5 mr-2 inline-block align-top"></i>
                                            <span>{{ item.notes }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button @click="editItineraryItem(item)" class="text-blue-700 hover:text-blue-900">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 交通時間（除了最後一個項目） -->
                            <div v-if="index < filteredItineraryItems.length - 1" class="mt-5 pt-5 border-t border-gray-100">
                                <div class="flex items-center text-gray-600">
                                    <div class="transport-icon" :class="getTransportClass(item.transportType)">
                                        <i :class="getTransportIcon(item.transportType)"></i>
                                    </div>
                                    <div>
                                        <span class="font-medium">{{ item.transportTime }}</span>
                                        <span class="text-sm ml-2">前往下個行程</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 導航按鈕 -->
                            <button 
                                @click="navigateTo(item.location)"
                                class="mt-5 w-full bg-blue-50 text-blue-700 py-3 rounded-xl font-semibold flex items-center justify-center hover:bg-blue-100 transition-colors"
                            >
                                <i class="fas fa-map-marked-alt mr-2"></i> 開始導航
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 資訊頁面 -->
            <div v-if="currentTab === 'info'" class="space-y-6">
                <!-- 匯率換算 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-exchange-alt mr-3 text-blue-700"></i> 匯率換算
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-1">輸入金額 (GBP)</label>
                                <input 
                                    type="number" 
                                    v-model="gbpAmount" 
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="輸入英鎊金額"
                                >
                            </div>
                            <div class="pt-5">
                                <i class="fas fa-arrow-right text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-1">換算為港幣 (HKD)</label>
                                <div class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50">
                                    {{ calculatedHKD }} HKD
                                </div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i> 匯率: 1 GBP = {{ exchangeRate }} HKD (更新時間: {{ exchangeRateDate }})
                        </div>
                    </div>
                </div>
                
                <!-- 航班資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-plane mr-3 text-blue-700"></i> 航班資訊
                    </h2>
                    
                    <!-- 去程航班 -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-3 text-blue-800">去程</h3>
                        <div class="bg-blue-50 rounded-xl p-4">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <div class="text-sm text-gray-600">出發</div>
                                    <div class="text-xl font-bold">香港 (HKG)</div>
                                    <div class="text-sm">28 七月 2026, 23:15</div>
                                </div>
                                <div class="text-center">
                                    <i class="fas fa-plane text-blue-500 text-2xl"></i>
                                    <div class="text-xs mt-1">飛行時間 12小時</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">抵達</div>
                                    <div class="text-xl font-bold">蘇黎世 (ZRH)</div>
                                    <div class="text-sm">29 七月 2026, 06:15</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">航班:</span> LX139
                                </div>
                                <div>
                                    <span class="text-gray-600">航空公司:</span> SWISS
                                </div>
                                <div>
                                    <span class="text-gray-600">登機:</span> 香港 HKG, 航站樓 1
                                </div>
                                <div>
                                    <span class="text-gray-600">艙位:</span> Economy Basic (T)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 回程航班 -->
                    <div>
                        <h3 class="font-bold text-lg mb-3 text-blue-800">回程</h3>
                        <div class="bg-blue-50 rounded-xl p-4">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <div class="text-sm text-gray-600">出發</div>
                                    <div class="text-xl font-bold">曼徹斯特 (MAN)</div>
                                    <div class="text-sm">13 八月 2026, 18:40</div>
                                </div>
                                <div class="text-center">
                                    <i class="fas fa-plane text-blue-500 text-2xl"></i>
                                    <div class="text-xs mt-1">轉機蘇黎世</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">抵達</div>
                                    <div class="text-xl font-bold">香港 (HKG)</div>
                                    <div class="text-sm">14 八月 2026, 16:40</div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">航班:</span> LX381 + LX138
                                </div>
                                <div>
                                    <span class="text-gray-600">航空公司:</span> SWISS
                                </div>
                                <div>
                                    <span class="text-gray-600">轉機:</span> 蘇黎世 (1小時)
                                </div>
                                <div>
                                    <span class="text-gray-600">艙位:</span> Economy Basic (T)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 住宿資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-hotel mr-3 text-blue-700"></i> 住宿資訊
                    </h2>
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-bed text-4xl mb-3"></i>
                        <div>住宿資訊後補，尚未預訂</div>
                    </div>
                </div>
                
                <!-- 租車資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-car mr-3 text-blue-700"></i> 租車資訊
                    </h2>
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-car text-4xl mb-3"></i>
                        <div>租車資訊後補，尚未預訂</div>
                    </div>
                </div>
                
                <!-- 緊急醫療資訊 -->
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-ambulance mr-3 text-red-600"></i> 緊急聯絡
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center p-3 bg-red-50 rounded-lg">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-police-box text-red-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold">警察</div>
                                <div class="text-sm text-gray-600">緊急電話: 999</div>
                            </div>
                            <button class="text-red-600">
                                <i class="fas fa-phone-alt"></i>
                            </button>
                        </div>
                        <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-ambulance text-blue-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold">救護車</div>
                                <div class="text-sm text-gray-600">緊急電話: 999</div>
                            </div>
                            <button class="text-blue-600">
                                <i class="fas fa-phone-alt"></i>
                            </button>
                        </div>
                        <div class="flex items-center p-3 bg-green-50 rounded-lg">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-fire-extinguisher text-green-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold">消防隊</div>
                                <div class="text-sm text-gray-600">緊急電話: 999</div>
                            </div>
                            <button class="text-green-600">
                                <i class="fas fa-phone-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 購物清單頁面 -->
            <div v-if="currentTab === 'shopping'" class="space-y-6">
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <h2 class="text-xl font-bold mb-6">購物清單</h2>
                    
                    <div v-if="shoppingList.length === 0" class="text-center py-10 text-gray-500">
                        <i class="fas fa-shopping-basket text-4xl mb-3"></i>
                        <div>購物清單為空</div>
                        <div class="text-sm mt-1">點擊右下角的 + 按鈕新增商品</div>
                    </div>
                    
                    <div v-else class="space-y-4">
                        <div 
                            v-for="item in shoppingList" 
                            :key="item.id"
                            class="flex items-center p-4 border border-gray-200 rounded-xl hover:bg-gray-50"
                        >
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center mr-4">
                                <i v-if="!item.image" class="fas fa-shopping-bag text-gray-500 text-xl"></i>
                                <img v-else :src="item.image" :alt="item.name" class="w-full h-full object-cover rounded-lg">
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold">{{ item.name }}</h3>
                                <div class="text-sm text-gray-500 mt-1">添加日期: {{ item.addedDate }}</div>
                            </div>
                            <button @click="removeShoppingItem(item.id)" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 花費頁面 -->
            <div v-if="currentTab === 'expenses'" class="space-y-6">
                <div class="bg-white rounded-2xl p-5 card-shadow">
                    <!-- 總花費 -->
                    <div class="mb-6">
                        <h2 class="text-xl font-bold mb-2">總花費</h2>
                        <div class="text-3xl font-bold text-blue-800">{{ totalExpenses }} JPY</div>
                        <div class="text-sm text-gray-500 mt-1">約 {{ Math.round(totalExpenses / exchangeRate) }} GBP</div>
                    </div>
                    
                    <!-- 花費列表 -->
                    <h3 class="font-bold mb-4">花費記錄</h3>
                    
                    <div v-if="expenses.length === 0" class="text-center py-10 text-gray-500">
                        <i class="fas fa-receipt text-4xl mb-3"></i>
                        <div>尚未記錄任何花費</div>
                        <div class="text-sm mt-1">點擊右下角的 + 按鈕新增記錄</div>
                    </div>
                    
                    <div v-else class="space-y-4">
                        <div 
                            v-for="expense in expenses" 
                            :key="expense.id"
                            class="p-4 border border-gray-200 rounded-xl"
                        >
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex items-center">
                                        <span class="category-badge" :class="getExpenseCategoryClass(expense.category)">
                                            {{ getExpenseCategoryName(expense.category) }}
                                        </span>
                                        <span class="ml-3 text-sm text-gray-500">{{ expense.date }}</span>
                                    </div>
                                    <h3 class="font-bold text-lg mt-2">{{ expense.name }}</h3>
                                    <div class="text-gray-700 mt-2">{{ expense.notes || '無備註' }}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xl font-bold text-blue-800">{{ expense.amount }} JPY</div>
                                    <div class="text-sm text-gray-500 mt-1">{{ expense.paymentMethod }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 浮動操作按鈕 -->
        <div 
            v-if="showFAB" 
            @click="handleFABClick"
            class="floating-action-btn"
        >
            <i class="fas fa-plus text-xl"></i>
        </div>
        
        <!-- 新增/編輯行程模態框 -->
        <div v-if="showItineraryModal" class="modal-overlay">
            <div class="modal-content w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">{{ editingItineraryItem ? '編輯行程' : '新增行程' }}</h3>
                        <button @click="closeItineraryModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">行程名稱</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.title"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入行程名稱"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">分類</label>
                            <select 
                                v-model="itineraryForm.category"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="attraction">景點</option>
                                <option value="accommodation">住宿</option>
                                <option value="food">美食</option>
                                <option value="shopping">購物</option>
                                <option value="flight">航班</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">時間</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.time"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: 09:00-12:00"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">營業時間</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.openingHours"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: 09:00-18:00"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">門票價格</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.ticketPrice"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: £18/人"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">特色與備註</label>
                            <textarea 
                                v-model="itineraryForm.notes"
                                rows="3"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入特色與備註"
                            ></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">交通方式</label>
                            <select 
                                v-model="itineraryForm.transportType"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="walk">步行</option>
                                <option value="drive">開車</option>
                                <option value="transit">大眾運輸</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">交通時間</label>
                            <input 
                                type="text" 
                                v-model="itineraryForm.transportTime"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="例: 30分鐘"
                            >
                        </div>
                    </div>
                    
                    <div class="flex justify-between mt-8">
                        <button 
                            v-if="editingItineraryItem"
                            @click="deleteItineraryItem"
                            class="px-5 py-3 bg-red-100 text-red-700 rounded-lg font-medium hover:bg-red-200"
                        >
                            刪除行程
                        </button>
                        <div v-else></div>
                        
                        <div class="space-x-3">
                            <button 
                                @click="closeItineraryModal"
                                class="px-5 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50"
                            >
                                取消
                            </button>
                            <button 
                                @click="saveItineraryItem"
                                class="px-5 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                儲存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 新增購物項目模態框 -->
        <div v-if="showShoppingModal" class="modal-overlay">
            <div class="modal-content w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">新增購物項目</h3>
                        <button @click="closeShoppingModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">商品名稱</label>
                            <input 
                                type="text" 
                                v-model="shoppingForm.name"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入商品名稱"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">商品圖片 (URL)</label>
                            <input 
                                type="text" 
                                v-model="shoppingForm.image"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入圖片網址 (選填)"
                            >
                        </div>
                        
                        <div class="pt-4">
                            <button 
                                @click="saveShoppingItem"
                                class="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                儲存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 新增花費模態框 -->
        <div v-if="showExpenseModal" class="modal-overlay">
            <div class="modal-content w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">新增花費記錄</h3>
                        <button @click="closeExpenseModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">類別</label>
                            <select 
                                v-model="expenseForm.category"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="transport">交通</option>
                                <option value="food">飲食</option>
                                <option value="accommodation">住宿</option>
                                <option value="ticket">門票</option>
                                <option value="shopping">購物</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">名稱</label>
                            <input 
                                type="text" 
                                v-model="expenseForm.name"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入花費項目名稱"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                            <input 
                                type="date" 
                                v-model="expenseForm.date"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">金額 (JPY)</label>
                            <input 
                                type="number" 
                                v-model="expenseForm.amount"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入金額"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">付款方式</label>
                            <select 
                                v-model="expenseForm.paymentMethod"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            >
                                <option value="現金">現金</option>
                                <option value="信用卡">信用卡</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">備註</label>
                            <textarea 
                                v-model="expenseForm.notes"
                                rows="2"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="輸入備註 (選填)"
                            ></textarea>
                        </div>
                        
                        <div class="pt-4">
                            <button 
                                @click="saveExpense"
                                class="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
                            >
                                儲存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        
        createApp({
            setup() {
                // 當前選中的標籤頁
                const currentTab = ref('itinerary');
                
                // 當前選中的日期
                const selectedDay = ref(1);
                
                // 分類篩選
                const categoryFilter = ref([]);
                
                // 顯示的模態框
                const showItineraryModal = ref(false);
                const showShoppingModal = ref(false);
                const showExpenseModal = ref(false);
                
                // 是否顯示浮動操作按鈕
                const showFAB = computed(() => {
                    return currentTab.value === 'itinerary' || 
                           currentTab.value === 'shopping' || 
                           currentTab.value === 'expenses';
                });
                
                // 編輯中的行程項目
                const editingItineraryItem = ref(null);
                
                // 日期資料
                const days = ref([
                    { id: 1, dayOfWeek: 'Wed', date: '29', month: 'Jul' },
                    { id: 2, dayOfWeek: 'Thu', date: '30', month: 'Jul' },
                    { id: 3, dayOfWeek: 'Fri', date: '31', month: 'Jul' },
                    { id: 4, dayOfWeek: 'Sat', date: '1', month: 'Aug' },
                    { id: 5, dayOfWeek: 'Sun', date: '2', month: 'Aug' },
                    { id: 6, dayOfWeek: 'Mon', date: '3', month: 'Aug' },
                    { id: 7, dayOfWeek: 'Tue', date: '4', month: 'Aug' },
                    { id: 8, dayOfWeek: 'Wed', date: '5', month: 'Aug' },
                    { id: 9, dayOfWeek: 'Thu', date: '6', month: 'Aug' },
                    { id: 10, dayOfWeek: 'Fri', date: '7', month: 'Aug' },
                    { id: 11, dayOfWeek: 'Sat', date: '8', month: 'Aug' },
                    { id: 12, dayOfWeek: 'Sun', date: '9', month: 'Aug' },
                    { id: 13, dayOfWeek: 'Mon', date: '10', month: 'Aug' },
                    { id: 14, dayOfWeek: 'Tue', date: '11', month: 'Aug' },
                    { id: 15, dayOfWeek: 'Wed', date: '12', month: 'Aug' },
                    { id: 16, dayOfWeek: 'Thu', date: '13', month: 'Aug' }
                ]);
                
                // 行程分類
                const categories = ref([
                    { id: 'attraction', name: '景點' },
                    { id: 'accommodation', name: '住宿' },
                    { id: 'food', name: '美食' },
                    { id: 'shopping', name: '購物' },
                    { id: 'flight', name: '航班' },
                    { id: 'other', name: '其他' }
                ]);
                
                // 行程資料
                const itineraryItems = ref([
                    // 第一天
                    {
                        id: 1,
                        day: 1,
                        category: 'flight',
                        title: '香港 → 蘇黎世 → 愛丁堡',
                        fromCode: 'HKG',
                        toCode: 'EDI',
                        flightNumber: 'LX139 + LX8290',
                        departureTime: '28 Jul 2026, 23:15',
                        arrivalTime: '29 Jul 2026, 08:40',
                        airline: 'SWISS + Edelweiss Air',
                        time: '08:40',
                        location: '愛丁堡機場',
                        notes: '抵達愛丁堡機場'
                    },
                    {
                        id: 2,
                        day: 1,
                        category: 'attraction',
                        title: '愛丁堡機場 → 市區',
                        time: '09:00-09:30',
                        openingHours: '',
                        ticketPrice: '£6.5/人',
                        notes: 'Airlink 100巴士，30分鐘',
                        transportType: 'transit',
                        transportTime: '30分鐘',
                        location: '愛丁堡機場巴士站'
                    },
                    {
                        id: 3,
                        day: 1,
                        category: 'accommodation',
                        title: '酒店寄存行李',
                        time: '09:35-10:00',
                        openingHours: '',
                        ticketPrice: '',
                        notes: '酒店寄存行李',
                        transportType: 'walk',
                        transportTime: '5分鐘',
                        location: '愛丁堡酒店'
                    },
                    {
                        id: 4,
                        day: 1,
                        category: 'attraction',
                        title: '老城徒步',
                        time: '10:00-18:00',
                        openingHours: '',
                        ticketPrice: '免費',
                        notes: 'Castlehill→維多利亞街→聖吉爾斯大教堂→皇家一英里→Grassmarket',
                        transportType: 'walk',
                        transportTime: '步行遊覽',
                        location: '愛丁堡老城'
                    },
                    {
                        id: 5,
                        day: 1,
                        category: 'food',
                        title: '晚餐',
                        time: '18:00-20:00',
                        openingHours: '',
                        ticketPrice: '',
                        notes: '愛丁堡當地餐廳',
                        transportType: 'walk',
                        transportTime: '10分鐘',
                        location: '愛丁堡餐廳'
                    },
                    // 第二天
                    {
                        id: 6,
                        day: 2,
                        category: 'attraction',
                        title: '愛丁堡城堡',
                        time: '09:00-12:00',
                        openingHours: '09:30-18:00',
                        ticketPrice: '£18/人',
                        notes: '需預約',
                        transportType: 'walk',
                        transportTime: '15分鐘',
                        location: '愛丁堡城堡'
                    }
                ]);
                
                // 購物清單
                const shoppingList = ref([
                    {
                        id: 1,
                        name: '蘇格蘭威士忌',
                        image: '',
                        addedDate: '2026-07-29'
                    },
                    {
                        id: 2,
                        name: '羊毛圍巾',
                        image: '',
                        addedDate: '2026-07-29'
                    },
                    {
                        id: 3,
                        name: '城堡紀念品',
                        image: '',
                        addedDate: '2026-07-30'
                    }
                ]);
                
                // 花費記錄
                const expenses = ref([
                    {
                        id: 1,
                        category: 'transport',
                        name: '機場巴士',
                        date: '2026-07-29',
                        amount: 1200,
                        paymentMethod: '現金',
                        notes: '機場到市區'
                    },
                    {
                        id: 2,
                        category: 'food',
                        name: '晚餐',
                        date: '2026-07-29',
                        amount: 4500,
                        paymentMethod: '信用卡',
                        notes: '愛丁堡餐廳'
                    },
                    {
                        id: 3,
                        category: 'ticket',
                        name: '愛丁堡城堡門票',
                        date: '2026-07-30',
                        amount: 3600,
                        paymentMethod: '信用卡',
                        notes: '預訂門票'
                    }
                ]);
                
                // 匯率換算
                const gbpAmount = ref(100);
                const exchangeRate = ref(10.5); // 1 GBP = 10.5 HKD
                const exchangeRateDate = ref('2026-07-28');
                
                // 表單數據
                const itineraryForm = ref({
                    title: '',
                    category: 'attraction',
                    time: '',
                    openingHours: '',
                    ticketPrice: '',
                    notes: '',
                    transportType: 'walk',
                    transportTime: ''
                });
                
                const shoppingForm = ref({
                    name: '',
                    image: ''
                });
                
                const expenseForm = ref({
                    category: 'transport',
                    name: '',
                    date: new Date().toISOString().split('T')[0],
                    amount: 0,
                    paymentMethod: '現金',
                    notes: ''
                });
                
                // 拖放排序相關
                const draggedItemIndex = ref(null);
                
                // 計算屬性
                const calculatedHKD = computed(() => {
                    return (gbpAmount.value * exchangeRate.value).toFixed(2);
                });
                
                const totalExpenses = computed(() => {
                    return expenses.value.reduce((sum, expense) => sum + expense.amount, 0);
                });
                
                const filteredItineraryItems = computed(() => {
                    let filtered = itineraryItems.value.filter(item => item.day === selectedDay.value);
                    
                    if (categoryFilter.value.length > 0) {
                        filtered = filtered.filter(item => categoryFilter.value.includes(item.category));
                    }
                    
                    return filtered;
                });
                
                // 方法
                const selectDay = (dayId) => {
                    selectedDay.value = dayId;
                };
                
                const toggleCategoryFilter = (categoryId) => {
                    const index = categoryFilter.value.indexOf(categoryId);
                    if (index === -1) {
                        categoryFilter.value.push(categoryId);
                    } else {
                        categoryFilter.value.splice(index, 1);
                    }
                };
                
                const getCategoryClass = (categoryId, isActive) => {
                    const baseClass = "flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium";
                    
                    if (!isActive) {
                        return `${baseClass} bg-gray-100 text-gray-700`;
                    }
                    
                    switch(categoryId) {
                        case 'attraction': return `${baseClass} bg-blue-100 text-blue-800`;
                        case 'accommodation': return `${baseClass} bg-green-100 text-green-800`;
                        case 'food': return `${baseClass} bg-yellow-100 text-yellow-800`;
                        case 'shopping': return `${baseClass} bg-pink-100 text-pink-800`;
                        case 'flight': return `${baseClass} bg-indigo-100 text-indigo-800`;
                        case 'other': return `${baseClass} bg-gray-200 text-gray-800`;
                        default: return `${baseClass} bg-gray-100 text-gray-700`;
                    }
                };
                
                const getCategoryBadgeClass = (category) => {
                    switch(category) {
                        case 'attraction': return 'category-badge category-attraction';
                        case 'accommodation': return 'category-badge category-accommodation';
                        case 'food': return 'category-badge category-food';
                        case 'shopping': return 'category-badge category-shopping';
                        case 'flight': return 'category-badge category-flight';
                        case 'other': return 'category-badge category-other';
                        default: return 'category-badge category-other';
                    }
                };
                
                const getCategoryName = (category) => {
                    const categoryObj = categories.value.find(c => c.id === category);
                    return categoryObj ? categoryObj.name : '其他';
                };
                
                const getTransportClass = (transportType) => {
                    switch(transportType) {
                        case 'walk': return 'transport-walk';
                        case 'drive': return 'transport-drive';
                        case 'transit': return 'transport-transit';
                        default: return 'transport-walk';
                    }
                };
                
                const getTransportIcon = (transportType) => {
                    switch(transportType) {
                        case 'walk': return 'fas fa-walking';
                        case 'drive': return 'fas fa-car';
                        case 'transit': return 'fas fa-bus';
                        default: return 'fas fa-walking';
                    }
                };
                
                const getExpenseCategoryClass = (category) => {
                    switch(category) {
                        case 'transport': return 'category-badge category-attraction';
                        case 'food': return 'category-badge category-food';
                        case 'accommodation': return 'category-badge category-accommodation';
                        case 'ticket': return 'category-badge category-flight';
                        case 'shopping': return 'category-badge category-shopping';
                        case 'other': return 'category-badge category-other';
                        default: return 'category-badge category-other';
                    }
                };
                
                const getExpenseCategoryName = (category) => {
                    switch(category) {
                        case 'transport': return '交通';
                        case 'food': return '飲食';
                        case 'accommodation': return '住宿';
                        case 'ticket': return '門票';
                        case 'shopping': return '購物';
                        case 'other': return '其他';
                        default: return '其他';
                    }
                };
                
                const navigateTo = (location) => {
                    // 這裡實際應用中會連結到 Google Maps
                    // 目前先用一個示範性的提示
                    alert(`導航到: ${location}\n\n實際應用中會開啟 Google Maps 進行導航`);
                };
                
                const handleFABClick = () => {
                    switch(currentTab.value) {
                        case 'itinerary':
                            openItineraryModal();
                            break;
                        case 'shopping':
                            openShoppingModal();
                            break;
                        case 'expenses':
                            openExpenseModal();
                            break;
                    }
                };
                
                const openItineraryModal = (item = null) => {
                    if (item) {
                        editingItineraryItem.value = item;
                        itineraryForm.value = { ...item };
                    } else {
                        editingItineraryItem.value = null;
                        itineraryForm.value = {
                            title: '',
                            category: 'attraction',
                            time: '',
                            openingHours: '',
                            ticketPrice: '',
                            notes: '',
                            transportType: 'walk',
                            transportTime: ''
                        };
                    }
                    showItineraryModal.value = true;
                };
                
                const closeItineraryModal = () => {
                    showItineraryModal.value = false;
                    editingItineraryItem.value = null;
                };
                
                const saveItineraryItem = () => {
                    if (!itineraryForm.value.title.trim()) {
                        alert('請輸入行程名稱');
                        return;
                    }
                    
                    if (editingItineraryItem.value) {
                        // 更新現有項目
                        const index = itineraryItems.value.findIndex(item => item.id === editingItineraryItem.value.id);
                        if (index !== -1) {
                            itineraryItems.value[index] = {
                                ...itineraryForm.value,
                                id: editingItineraryItem.value.id,
                                day: selectedDay.value,
                                location: itineraryForm.value.title
                            };
                        }
                    } else {
                        // 新增項目
                        const newId = Math.max(...itineraryItems.value.map(item => item.id)) + 1;
                        itineraryItems.value.push({
                            ...itineraryForm.value,
                            id: newId,
                            day: selectedDay.value,
                            location: itineraryForm.value.title
                        });
                    }
                    
                    closeItineraryModal();
                };
                
                const deleteItineraryItem = () => {
                    if (confirm('確定要刪除這個行程嗎？')) {
                        const index = itineraryItems.value.findIndex(item => item.id === editingItineraryItem.value.id);
                        if (index !== -1) {
                            itineraryItems.value.splice(index, 1);
                        }
                        closeItineraryModal();
                    }
                };
                
                const editItineraryItem = (item) => {
                    openItineraryModal(item);
                };
                
                const dragStart = (index) => {
                    draggedItemIndex.value = index;
                };
                
                const dragOver = (index) => {
                    // 防止預設行為以允許拖放
                };
                
                const drop = (index) => {
                    if (draggedItemIndex.value === null || draggedItemIndex.value === index) return;
                    
                    // 重新排序項目
                    const items = filteredItineraryItems.value;
                    const draggedItem = items[draggedItemIndex.value];
                    
                    // 從原位置移除
                    items.splice(draggedItemIndex.value, 1);
                    // 插入到新位置
                    items.splice(index, 0, draggedItem);
                    
                    // 更新原始數組（這裡簡化處理，實際應用中需要更複雜的邏輯來處理跨日排序）
                    const dayItems = itineraryItems.value.filter(item => item.day === selectedDay.value);
                    const otherItems = itineraryItems.value.filter(item => item.day !== selectedDay.value);
                    
                    // 重新賦值
                    itineraryItems.value = [...otherItems, ...items];
                    
                    draggedItemIndex.value = null;
                };
                
                const openShoppingModal = () => {
                    shoppingForm.value = {
                        name: '',
                        image: ''
                    };
                    showShoppingModal.value = true;
                };
                
                const closeShoppingModal = () => {
                    showShoppingModal.value = false;
                };
                
                const saveShoppingItem = () => {
                    if (!shoppingForm.value.name.trim()) {
                        alert('請輸入商品名稱');
                        return;
                    }
                    
                    const newId = shoppingList.value.length > 0 ? Math.max(...shoppingList.value.map(item => item.id)) + 1 : 1;
                    shoppingList.value.push({
                        ...shoppingForm.value,
                        id: newId,
                        addedDate: new Date().toISOString().split('T')[0]
                    });
                    
                    closeShoppingModal();
                };
                
                const removeShoppingItem = (id) => {
                    if (confirm('確定要刪除這個購物項目嗎？')) {
                        const index = shoppingList.value.findIndex(item => item.id === id);
                        if (index !== -1) {
                            shoppingList.value.splice(index, 1);
                        }
                    }
                };
                
                const openExpenseModal = () => {
                    expenseForm.value = {
                        category: 'transport',
                        name: '',
                        date: new Date().toISOString().split('T')[0],
                        amount: 0,
                        paymentMethod: '現金',
                        notes: ''
                    };
                    showExpenseModal.value = true;
                };
                
                const closeExpenseModal = () => {
                    showExpenseModal.value = false;
                };
                
                const saveExpense = () => {
                    if (!expenseForm.value.name.trim()) {
                        alert('請輸入花費項目名稱');
                        return;
                    }
                    
                    if (expenseForm.value.amount <= 0) {
                        alert('請輸入正確的金額');
                        return;
                    }
                    
                    const newId = expenses.value.length > 0 ? Math.max(...expenses.value.map(item => item.id)) + 1 : 1;
                    expenses.value.push({
                        ...expenseForm.value,
                        id: newId,
                        amount: Number(expenseForm.value.amount)
                    });
                    
                    closeExpenseModal();
                };
                
                // 初始化
                onMounted(() => {
                    console.log('應用已載入');
                });
                
                return {
                    currentTab,
                    selectedDay,
                    categoryFilter,
                    showItineraryModal,
                    showShoppingModal,
                    showExpenseModal,
                    showFAB,
                    editingItineraryItem,
                    days,
                    categories,
                    itineraryItems,
                    shoppingList,
                    expenses,
                    gbpAmount,
                    exchangeRate,
                    exchangeRateDate,
                    itineraryForm,
                    shoppingForm,
                    expenseForm,
                    calculatedHKD,
                    totalExpenses,
                    filteredItineraryItems,
                    selectDay,
                    toggleCategoryFilter,
                    getCategoryClass,
                    getCategoryBadgeClass,
                    getCategoryName,
                    getTransportClass,
                    getTransportIcon,
                    getExpenseCategoryClass,
                    getExpenseCategoryName,
                    navigateTo,
                    handleFABClick,
                    openItineraryModal,
                    closeItineraryModal,
                    saveItineraryItem,
                    deleteItineraryItem,
                    editItineraryItem,
                    dragStart,
                    dragOver,
                    drop,
                    openShoppingModal,
                    closeShoppingModal,
                    saveShoppingItem,
                    removeShoppingItem,
                    openExpenseModal,
                    closeExpenseModal,
                    saveExpense
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
