<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英國17天行程｜旅遊編輯與分享</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }
        
        .trip-title {
            font-size: 2.2rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .trip-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: #ff7e5f;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #ff6b4a;
            transform: translateY(-3px);
        }
        
        .btn-secondary {
            background-color: white;
            color: #2a5298;
        }
        
        .btn-secondary:hover {
            background-color: #f0f0f0;
            transform: translateY(-3px);
        }
        
        .btn-edit {
            background-color: #4CAF50;
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .btn-edit:hover {
            background-color: #3d8b40;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            position: relative;
        }
        
        .card-title {
            color: #1e3c72;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f5ff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        
        .card-title i {
            color: #ff7e5f;
        }
        
        .edit-icon {
            cursor: pointer;
            color: #666;
            font-size: 1.2rem;
            transition: color 0.3s;
        }
        
        .edit-icon:hover {
            color: #2a5298;
        }
        
        .trip-overview {
            grid-column: 1 / -1;
        }
        
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .overview-item {
            background-color: #f8faff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
            position: relative;
        }
        
        .editable {
            min-height: 24px;
            padding: 2px 4px;
            border: 1px dashed transparent;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        .editable:hover {
            background-color: #f0f7ff;
            border-color: #a0c1ff;
        }
        
        .editable:focus {
            outline: none;
            border: 1px solid #2a5298;
            background-color: #fff;
        }
        
        .overview-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .overview-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e3c72;
        }
        
        .day-card {
            margin-bottom: 20px;
            border-left: 5px solid #ff7e5f;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .day-title {
            font-size: 1.3rem;
            color: #1e3c72;
        }
        
        .day-theme {
            background-color: #e6f0ff;
            color: #2a5298;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .activity-list {
            list-style-type: none;
        }
        
        .activity-item {
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            align-items: flex-start;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            min-width: 80px;
            font-weight: 600;
            color: #ff7e5f;
        }
        
        .activity-desc {
            flex: 1;
        }
        
        .cost-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .cost-table th, .cost-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .cost-table th {
            background-color: #f0f5ff;
            color: #1e3c72;
            font-weight: 600;
        }
        
        .cost-table tr:last-child td {
            border-bottom: 2px solid #2a5298;
            font-weight: 700;
        }
        
        .budget-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .budget-total-label {
            font-size: 1.1rem;
            color: #1e3c72;
            font-weight: 600;
        }
        
        .budget-total-value {
            font-size: 1.8rem;
            color: #ff7e5f;
            font-weight: 700;
        }
        
        .flight-details {
            background-color: #f8faff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .flight-leg {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        
        .flight-leg:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .flight-info {
            display: flex;
            flex-direction: column;
        }
        
        .flight-route {
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        
        .flight-time {
            color: #666;
            font-size: 0.9rem;
        }
        
        .flight-number {
            background-color: #e6f0ff;
            color: #2a5298;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            align-self: flex-start;
        }
        
        .map-container {
            height: 300px;
            background-color: #e9ecef;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-style: italic;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }
        
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #1e3c72;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
        }
        
        .share-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .share-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .share-btn:hover {
            transform: translateY(-5px);
        }
        
        .share-facebook {
            background-color: #3b5998;
        }
        
        .share-whatsapp {
            background-color: #25D366;
        }
        
        .share-link {
            background-color: #2a5298;
        }
        
        .link-container {
            display: flex;
            margin-top: 20px;
        }
        
        #shareable-link {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 0.9rem;
        }
        
        .copy-link {
            background-color: #2a5298;
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
        
        .weather-section {
            grid-column: 1 / -1;
        }
        
        .weather-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .weather-day {
            background-color: #f8faff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .weather-date {
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .weather-icon {
            font-size: 2rem;
            margin: 10px 0;
            color: #ff7e5f;
        }
        
        .weather-temp {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2a5298;
        }
        
        .weather-desc {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .edit-mode {
            border: 2px solid #4CAF50;
        }
        
        .edit-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .data-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2a5298;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 0.9rem;
            z-index: 999;
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .action-buttons {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .trip-title {
                font-size: 1.8rem;
            }
            
            .overview-grid {
                grid-template-columns: 1fr;
            }
            
            .day-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .weather-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .action-buttons {
                gap: 10px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1 class="trip-title" id="tripTitle" contenteditable="true">英國17天行程</h1>
                    <p class="trip-subtitle" id="tripSubtitle" contenteditable="true">2026年7月29日 - 8月13日 | 3人同行 | 愛丁堡→蘇格蘭高地→曼徹斯特</p>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-edit" id="toggleEditBtn">
                        <i class="fas fa-edit"></i> 編輯模式
                    </button>
                    <button class="btn btn-primary" id="shareBtn">
                        <i class="fas fa-share-alt"></i> 分享行程
                    </button>
                    <button class="btn btn-secondary" id="exportBtn">
                        <i class="fas fa-file-pdf"></i> 導出PDF
                    </button>
                    <button class="btn btn-secondary" id="saveBtn">
                        <i class="fas fa-save"></i> 保存
                    </button>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="card trip-overview">
                <h2 class="card-title">
                    <span><i class="fas fa-map-marked-alt"></i> 行程總覽</span>
                    <i class="fas fa-edit edit-icon" id="editOverview"></i>
                </h2>
                <div class="overview-grid">
                    <div class="overview-item">
                        <div class="overview-label">旅行日期</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false" id="tripDates">2026.07.29 - 08.13</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">天數</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false" id="tripDays">16天15晚</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">人數</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false" id="tripPeople">3人</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">主要交通</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false" id="tripTransport">火車 + 自駕</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">路線</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false" id="tripRoute">愛丁堡 → 蘇格蘭高地 → 格拉斯哥 → 湖區 → 利物浦 → 切斯特 → 曼徹斯特</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card weather-section">
                <h2 class="card-title">
                    <span><i class="fas fa-cloud-sun"></i> 天氣預報（英國夏季典型天氣）</span>
                    <i class="fas fa-sync-alt edit-icon" id="refreshWeather"></i>
                </h2>
                <div class="weather-container" id="weatherContainer">
                    <!-- 天氣預報將由JavaScript動態生成 -->
                </div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666; text-align: center;">
                    <i class="fas fa-info-circle"></i> 這是英國夏季典型天氣預測，實際天氣可能有所不同。夏季平均溫度：12-20°C，多雲偶有雨。
                </p>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-plane-departure"></i> 去程航班</span>
                    <i class="fas fa-edit edit-icon" id="editFlightOut"></i>
                </h2>
                <div class="flight-details">
                    <div class="flight-leg">
                        <div class="flight-info">
                            <div class="flight-route editable" contenteditable="false">香港 → 蘇黎世</div>
                            <div class="flight-time editable" contenteditable="false">2026年7月28日 23:15 - 7月29日 06:15 (瑞士国际航空 LX139)</div>
                            <span class="flight-number editable" contenteditable="false">經濟艙基礎票價</span>
                        </div>
                    </div>
                    <div class="flight-leg">
                        <div class="flight-info">
                            <div class="flight-route editable" contenteditable="false">蘇黎世 → 愛丁堡</div>
                            <div class="flight-time editable" contenteditable="false">2026年7月29日 07:30 - 08:40 (雪绒花航空 LX8290)</div>
                            <span class="flight-number editable" contenteditable="false">經濟艙基礎票價</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-plane-arrival"></i> 回程航班</span>
                    <i class="fas fa-edit edit-icon" id="editFlightIn"></i>
                </h2>
                <div class="flight-details">
                    <div class="flight-leg">
                        <div class="flight-info">
                            <div class="flight-route editable" contenteditable="false">曼徹斯特 → 蘇黎世</div>
                            <div class="flight-time editable" contenteditable="false">2026年8月12日 18:40 - 21:40 (瑞士国际航空 LX381)</div>
                            <span class="flight-number editable" contenteditable="false">經濟艙基礎Plus票價</span>
                        </div>
                    </div>
                    <div class="flight-leg">
                        <div class="flight-info">
                            <div class="flight-route editable" contenteditable="false">蘇黎世 → 香港</div>
                            <div class="flight-time editable" contenteditable="false">2026年8月12日 22:40 - 8月13日 16:40 (瑞士国际航空 LX138)</div>
                            <span class="flight-number editable" contenteditable="false">經濟艙基礎Plus票價</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-calendar-alt"></i> 每日行程</span>
                    <i class="fas fa-edit edit-icon" id="editItinerary"></i>
                </h2>
                
                <!-- 第1天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第1天｜7月29日（週三）｜愛丁堡抵達</h3>
                        <span class="day-theme editable" contenteditable="false">歷史老城漫步</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">08:40</span>
                            <span class="activity-desc editable" contenteditable="false">抵達愛丁堡機場</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">09:00-09:30</span>
                            <span class="activity-desc editable" contenteditable="false">機場→市區（Airlink 100巴士，30分鐘，£19.5總｜£6.5/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">09:35-10:00</span>
                            <span class="activity-desc editable" contenteditable="false">酒店寄存行李</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">10:00-18:00</span>
                            <span class="activity-desc editable" contenteditable="false">老城徒步：Castlehill→維多利亞街→聖吉爾斯大教堂→皇家一英里→Grassmarket</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">18:00-20:00</span>
                            <span class="activity-desc editable" contenteditable="false">晚餐</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第2天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第2天｜7月30日（週四）｜愛丁堡城堡</h3>
                        <span class="day-theme editable" contenteditable="false">皇室地標與隱世村落</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">09:00-12:00</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡城堡（需預約，£54總｜£18/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">12:30-14:30</span>
                            <span class="activity-desc editable" contenteditable="false">皇家遊艇不列顛尼亞號（巴士前往，£36總｜£12/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">15:00-16:30</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡皇家植物園（免費，溫室£7.5總｜£2.5/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">17:00-18:00</span>
                            <span class="activity-desc editable" contenteditable="false">Dean Village（步行25分鐘）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第3天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第3天｜7月31日（週五）｜愛丁堡藝術文化</h3>
                        <span class="day-theme editable" contenteditable="false">博物館與威士忌</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">09:00-10:00</span>
                            <span class="activity-desc editable" contenteditable="false">卡爾頓山（免費）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">10:30-12:30</span>
                            <span class="activity-desc editable" contenteditable="false">蘇格蘭國立博物館（免費）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">13:30-15:00</span>
                            <span class="activity-desc editable" contenteditable="false">蘇格蘭國家畫廊（免費）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">15:30-16:30</span>
                            <span class="activity-desc editable" contenteditable="false">蘇格蘭威士忌體驗中心（£45總｜£15/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第4-6天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第4-6天｜8月1-3日（週六至一）｜高地與斯凱島三日團</h3>
                        <span class="day-theme editable" contenteditable="false">跟團行程</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">第4天 (8/1)</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡→洛蒙德湖→格倫科峽谷→威廉堡→斯凱島</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">第5天 (8/2)</span>
                            <span class="activity-desc editable" contenteditable="false">斯凱島全日遊（波特里、The Storr、Kilt Rock、鄧韋根城堡）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">第6天 (8/3)</span>
                            <span class="activity-desc editable" contenteditable="false">艾琳多南城堡→尼斯湖→返回愛丁堡（約19:00抵達）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">費用</span>
                            <span class="activity-desc editable" contenteditable="false">£960總｜£320/人</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">斯凱島2晚，第6晚愛丁堡</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第7天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第7天｜8月4日（週二）｜前往格拉斯哥</h3>
                        <span class="day-theme editable" contenteditable="false">租車與城市核心</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">10:00-10:50</span>
                            <span class="activity-desc editable" contenteditable="false">愛丁堡→格拉斯哥（火車，50分鐘，£36總｜£12/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">14:00</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯哥取車（租車5天，£450總｜£150/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯哥市區：喬治廣場→格拉斯哥大教堂</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯哥</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第8天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第8天｜8月5日（週三）｜格拉斯哥藝術科學</h3>
                        <span class="day-theme editable" contenteditable="false">大學城與博物館</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯哥大學→Hunterian博物館</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">凱文葛羅夫藝術博物館→河濱博物館</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯哥</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第9天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第9天｜8月6日（週四）｜前往湖區</h3>
                        <span class="day-theme editable" contenteditable="false">自駕前往湖區</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯哥市區最後探索</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">14:00-16:30</span>
                            <span class="activity-desc editable" contenteditable="false">駕車前往湖區（2.5小時，約140英里）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">傍晚</span>
                            <span class="activity-desc editable" contenteditable="false">湖區民宿入住</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">湖區溫德米爾</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第10天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第10天｜8月7日（週五）｜湖區全日</h3>
                        <span class="day-theme editable" contenteditable="false">自駕小艇與湖光山色</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">09:00-10:30</span>
                            <span class="activity-desc editable" contenteditable="false">溫德米爾湖自駕小艇（£70總｜£23.3/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">格拉斯米爾小鎮（駕車15分鐘）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">溫德米爾湖漫步→鮑內斯小鎮</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">湖區</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第11天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第11天｜8月8日（週六）｜前往利物浦</h3>
                        <span class="day-theme editable" contenteditable="false">音樂遺產之旅</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">湖區最後探索</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">12:00-14:00</span>
                            <span class="activity-desc editable" contenteditable="false">駕車前往利物浦（2小時，約90英里）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">阿爾伯特碼頭→披頭四故事館</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">利物浦</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第12天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第12天｜8月9日（週日）｜利物浦全日</h3>
                        <span class="day-theme editable" contenteditable="false">披頭四與購物</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">洞穴俱樂部→The Cavern Pub</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">利物浦博物館→阿爾伯特碼頭購物區</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">利物浦</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第13天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第13天｜8月10日（週一）｜利物浦→切斯特</h3>
                        <span class="day-theme editable" contenteditable="false">羅馬古城</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">利物浦自由活動</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">12:00-13:00</span>
                            <span class="activity-desc editable" contenteditable="false">駕車前往切斯特（1小時，35英里）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">13:00</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特還車（租車結束）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特古城：城牆漫步→切斯特座堂</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第14天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第14天｜8月11日（週二）｜切斯特全日</h3>
                        <span class="day-theme editable" contenteditable="false">購物與羅馬遺跡</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">徹斯特奧克斯名品暢貨中心購物（巴士前往，20分鐘）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特羅馬圓形劇場→The Rows獨特商店街</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第15天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第15天｜8月12日（週三）｜切斯特→曼徹斯特</h3>
                        <span class="day-theme editable" contenteditable="false">前往曼徹斯特</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特最後探索</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">12:00-13:00</span>
                            <span class="activity-desc editable" contenteditable="false">切斯特→曼徹斯特（火車，1小時，£24總｜£8/人）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">下午</span>
                            <span class="activity-desc editable" contenteditable="false">曼徹斯特市區初探</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">住宿</span>
                            <span class="activity-desc editable" contenteditable="false">曼徹斯特</span>
                        </li>
                    </ul>
                </div>
                
                <!-- 第16天 -->
                <div class="day-card card">
                    <div class="day-header">
                        <h3 class="day-title editable" contenteditable="false">第16天｜8月13日（週四）｜曼徹斯特→香港</h3>
                        <span class="day-theme editable" contenteditable="false">回程</span>
                    </div>
                    <ul class="activity-list">
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">上午</span>
                            <span class="activity-desc editable" contenteditable="false">曼徹斯特最後遊覽：科學產業博物館→北區文藝區</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">14:00-14:20</span>
                            <span class="activity-desc editable" contenteditable="false">前往曼徹斯特機場（火車，20分鐘）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">15:40前</span>
                            <span class="activity-desc editable" contenteditable="false">辦理登機手續（起飛前3小時）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">18:40</span>
                            <span class="activity-desc editable" contenteditable="false">航班LX381起飛（曼徹斯特→蘇黎世）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">21:40-22:40</span>
                            <span class="activity-desc editable" contenteditable="false">蘇黎世轉機（1小時）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">22:40</span>
                            <span class="activity-desc editable" contenteditable="false">航班LX138起飛（蘇黎世→香港）</span>
                        </li>
                        <li class="activity-item">
                            <span class="activity-time editable" contenteditable="false">+1天16:40</span>
                            <span class="activity-desc editable" contenteditable="false">抵達香港國際機場</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-car"></i> 自駕階段詳情</span>
                    <i class="fas fa-edit edit-icon" id="editDriving"></i>
                </h2>
                <div class="overview-grid">
                    <div class="overview-item">
                        <div class="overview-label">租車期間</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">8月4日14:00 - 8月10日13:00（6天）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">路線</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">格拉斯哥→湖區→利物浦→切斯特</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">總里程</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">約265英里（425公里）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">租車費用</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">£450總｜£150/人</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">預計油費</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">£130總｜£43.3/人</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">預計停車費</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">£50總｜£16.7/人</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-train"></i> 主要火車行程</span>
                    <i class="fas fa-edit edit-icon" id="editTrains"></i>
                </h2>
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>路線</th>
                            <th>日期與時間</th>
                            <th>費用</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="editable" contenteditable="false">愛丁堡→格拉斯哥</span></td>
                            <td><span class="editable" contenteditable="false">8月4日 10:00-10:50（50分鐘）</span></td>
                            <td><span class="editable" contenteditable="false">£36總｜£12/人</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">切斯特→曼徹斯特</span></td>
                            <td><span class="editable" contenteditable="false">8月12日 12:00-13:00（1小時）</span></td>
                            <td><span class="editable" contenteditable="false">£24總｜£8/人</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">曼徹斯特市區→機場</span></td>
                            <td><span class="editable" contenteditable="false">8月13日 14:00-14:20（20分鐘）</span></td>
                            <td><span class="editable" contenteditable="false">£4.9/人</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-pound-sign"></i> 3人預算總表</span>
                    <i class="fas fa-edit edit-icon" id="editBudget"></i>
                </h2>
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>總費用</th>
                            <th>人均</th>
                            <th>備註</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="editable" contenteditable="false">高地三日團</span></td>
                            <td><span class="editable" contenteditable="false">£960</span></td>
                            <td><span class="editable" contenteditable="false">£320</span></td>
                            <td><span class="editable" contenteditable="false">已包含導覽、部分住宿</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">租車6天</span></td>
                            <td><span class="editable" contenteditable="false">£450</span></td>
                            <td><span class="editable" contenteditable="false">£150</span></td>
                            <td><span class="editable" contenteditable="false">含基本保險</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">主要火車票</span></td>
                            <td><span class="editable" contenteditable="false">£120</span></td>
                            <td><span class="editable" contenteditable="false">£40</span></td>
                            <td><span class="editable" contenteditable="false">需提前預訂</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">湖區自駕小艇</span></td>
                            <td><span class="editable" contenteditable="false">£70</span></td>
                            <td><span class="editable" contenteditable="false">£23.3</span></td>
                            <td><span class="editable" contenteditable="false">需預約</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">住宿15晚</span></td>
                            <td><span class="editable" contenteditable="false">£1,700</span></td>
                            <td><span class="editable" contenteditable="false">£567</span></td>
                            <td><span class="editable" contenteditable="false">平均£113/晚/房</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">餐飲預算</span></td>
                            <td><span class="editable" contenteditable="false">£1,080</span></td>
                            <td><span class="editable" contenteditable="false">£360</span></td>
                            <td><span class="editable" contenteditable="false">£22.5/人/天</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">門票活動</span></td>
                            <td><span class="editable" contenteditable="false">£240</span></td>
                            <td><span class="editable" contenteditable="false">£80</span></td>
                            <td><span class="editable" contenteditable="false">城堡、博物館等</span></td>
                        </tr>
                        <tr>
                            <td><span class="editable" contenteditable="false">購物預算</span></td>
                            <td><span class="editable" contenteditable="false">£300</span></td>
                            <td><span class="editable" contenteditable="false">£100</span></td>
                            <td><span class="editable" contenteditable="false">彈性</span></td>
                        </tr>
                    </tbody>
                </table>
                <div class="budget-total">
                    <div class="budget-total-label">總預算（不含個人購物）</div>
                    <div class="budget-total-value"><span class="editable" contenteditable="false">£3,920 總｜£1,307/人</span></div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span><i class="fas fa-hotel"></i> 住宿分佈</span>
                    <i class="fas fa-edit edit-icon" id="editAccommodation"></i>
                </h2>
                <div class="overview-grid">
                    <div class="overview-item">
                        <div class="overview-label">愛丁堡</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">4晚（7/29-31, 8/3）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">斯凱島</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">2晚（8/1-2，團安排）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">格拉斯哥</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">3晚（8/4-6）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">湖區</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">2晚（8/6-7）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">利物浦</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">3晚（8/8-10）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">切斯特</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">2晚（8/10-11）</span>
                        </div>
                    </div>
                    <div class="overview-item">
                        <div class="overview-label">曼徹斯特</div>
                        <div class="overview-value">
                            <span class="editable" contenteditable="false">1晚（8/12）</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="map-container">
            <p><i class="fas fa-map"></i> 行程路線地圖：愛丁堡 → 蘇格蘭高地 → 格拉斯哥 → 湖區 → 利物浦 → 切斯特 → 曼徹斯特</p>
        </div>
        
        <div class="footer">
            <p>旅遊行程編輯器 | 英國17天行程 | 最後更新：<span id="lastUpdated">2026年7月</span></p>
            <p>此行程可編輯、分享並導出為PDF文件</p>
        </div>
    </div>
    
    <!-- 分享模態框 -->
    <div class="share-modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">分享行程</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <p>將您的旅遊行程分享給朋友或家人：</p>
            
            <div class="share-options">
                <div class="share-btn share-facebook" id="shareFacebook">
                    <i class="fab fa-facebook-f"></i>
                </div>
                <div class="share-btn share-whatsapp" id="shareWhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <div class="share-btn share-link" id="shareLinkBtn">
                    <i class="fas fa-link"></i>
                </div>
            </div>
            
            <div class="link-container">
                <input type="text" id="shareable-link" readonly>
                <button class="copy-link" id="copyLink">複製</button>
            </div>
            
            <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                <i class="fas fa-info-circle"></i> 此連結包含您編輯後的行程內容。當您修改行程後，請重新分享此連結以獲取最新版本。
            </p>
        </div>
    </div>
    
    <!-- 通知 -->
    <div class="notification" id="notification">
        內容已保存！
    </div>
    
    <!-- 數據狀態顯示 -->
    <div class="data-status" id="dataStatus">
        數據已加載
    </div>

    <script>
        // 行程數據存儲
        let tripData = {
            title: "英國17天行程",
            subtitle: "2026年7月29日 - 8月13日 | 3人同行 | 愛丁堡→蘇格蘭高地→曼徹斯特",
            overview: {
                dates: "2026.07.29 - 08.13",
                days: "16天15晚",
                people: "3人",
                transport: "火車 + 自駕",
                route: "愛丁堡 → 蘇格蘭高地 → 格拉斯哥 → 湖區 → 利物浦 → 切斯特 → 曼徹斯特"
            },
            flights: {
                outbound: [
                    "香港 → 蘇黎世",
                    "2026年7月28日 23:15 - 7月29日 06:15 (瑞士国际航空 LX139)",
                    "經濟艙基礎票價"
                ],
                inbound: [
                    "曼徹斯特 → 蘇黎世",
                    "2026年8月12日 18:40 - 21:40 (瑞士国际航空 LX381)",
                    "經濟艙基礎Plus票價",
                    "蘇黎世 → 香港",
                    "2026年8月12日 22:40 - 8月13日 16:40 (瑞士国际航空 LX138)",
                    "經濟艙基礎Plus票價"
                ]
            },
            itinerary: {},
            lastUpdated: new Date().toLocaleDateString('zh-Hant')
        };
        
        // 天氣數據
        const weatherData = [
            { date: "7/29", day: "週三", location: "愛丁堡", icon: "fa-cloud-sun", temp: "16°C", desc: "多雲" },
            { date: "7/30", day: "週四", location: "愛丁堡", icon: "fa-sun", temp: "18°C", desc: "晴" },
            { date: "7/31", day: "週五", location: "愛丁堡", icon: "fa-cloud-rain", temp: "15°C", desc: "小雨" },
            { date: "8/1", day: "週六", location: "高地", icon: "fa-cloud", temp: "14°C", desc: "多雲" },
            { date: "8/2", day: "週日", location: "斯凱島", icon: "fa-cloud-sun-rain", temp: "13°C", desc: "陣雨" },
            { date: "8/3", day: "週一", location: "高地", icon: "fa-cloud", temp: "14°C", desc: "多雲" },
            { date: "8/4", day: "週二", location: "格拉斯哥", icon: "fa-cloud-sun", temp: "17°C", desc: "多雲時晴" },
            { date: "8/5", day: "週三", location: "格拉斯哥", icon: "fa-sun", temp: "19°C", desc: "晴" },
            { date: "8/6", day: "週四", location: "格拉斯哥→湖區", icon: "fa-cloud", temp: "16°C", desc: "多雲" },
            { date: "8/7", day: "週五", location: "湖區", icon: "fa-cloud-rain", temp: "15°C", desc: "小雨" },
            { date: "8/8", day: "週六", location: "湖區→利物浦", icon: "fa-cloud-sun", temp: "17°C", desc: "多雲" },
            { date: "8/9", day: "週日", location: "利物浦", icon: "fa-sun", temp: "20°C", desc: "晴" },
            { date: "8/10", day: "週一", location: "利物浦→切斯特", icon: "fa-cloud-sun", temp: "18°C", desc: "多雲時晴" },
            { date: "8/11", day: "週二", location: "切斯特", icon: "fa-cloud-rain", temp: "16°C", desc: "陣雨" },
            { date: "8/12", day: "週三", location: "切斯特→曼徹斯特", icon: "fa-cloud", temp: "17°C", desc: "多雲" },
            { date: "8/13", day: "週四", location: "曼徹斯特", icon: "fa-cloud-sun", temp: "18°C", desc: "多雲時晴" }
        ];
        
        // 編輯模式狀態
        let isEditMode = false;
        let editTimeout = null;
        
        // 獲取DOM元素
        const toggleEditBtn = document.getElementById('toggleEditBtn');
        const shareBtn = document.getElementById('shareBtn');
        const exportBtn = document.getElementById('exportBtn');
        const saveBtn = document.getElementById('saveBtn');
        const shareModal = document.getElementById('shareModal');
        const closeModal = document.getElementById('closeModal');
        const copyLinkBtn = document.getElementById('copyLink');
        const shareableLink = document.getElementById('shareable-link');
        const weatherContainer = document.getElementById('weatherContainer');
        const lastUpdatedEl = document.getElementById('lastUpdated');
        const notification = document.getElementById('notification');
        const refreshWeatherBtn = document.getElementById('refreshWeather');
        const dataStatus = document.getElementById('dataStatus');
        
        // 初始化頁面
        function initPage() {
            // 檢查URL參數並加載行程數據
            checkUrlParams();
            
            // 渲染天氣預報
            renderWeather();
            
            // 設置事件監聽器
            setupEventListeners();
            
            // 生成分享連結
            updateShareLink();
            
            // 顯示數據狀態
            updateDataStatus();
        }
        
        // 渲染天氣預報
        function renderWeather() {
            weatherContainer.innerHTML = '';
            
            weatherData.forEach(day => {
                const weatherDay = document.createElement('div');
                weatherDay.className = 'weather-day';
                weatherDay.innerHTML = `
                    <div class="weather-date">${day.date} ${day.day}</div>
                    <div class="weather-location">${day.location}</div>
                    <div class="weather-icon"><i class="fas ${day.icon}"></i></div>
                    <div class="weather-temp">${day.temp}</div>
                    <div class="weather-desc">${day.desc}</div>
                `;
                weatherContainer.appendChild(weatherDay);
            });
        }
        
        // 設置事件監聽器
        function setupEventListeners() {
            // 切換編輯模式
            toggleEditBtn.addEventListener('click', toggleEditMode);
            
            // 分享按鈕
            shareBtn.addEventListener('click', () => {
                shareModal.style.display = 'flex';
                updateShareLink();
            });
            
            // 保存按鈕
            saveBtn.addEventListener('click', function() {
                saveDataToStorage();
                showNotification('行程已保存到本地');
            });
            
            // 關閉模態框
            closeModal.addEventListener('click', () => {
                shareModal.style.display = 'none';
            });
            
            // 點擊模態框外部關閉
            window.addEventListener('click', (e) => {
                if (e.target === shareModal) {
                    shareModal.style.display = 'none';
                }
            });
            
            // 複製連結
            copyLinkBtn.addEventListener('click', copyShareLink);
            
            // 社交媒體分享
            document.getElementById('shareFacebook').addEventListener('click', shareOnFacebook);
            document.getElementById('shareWhatsApp').addEventListener('click', shareOnWhatsApp);
            document.getElementById('shareLinkBtn').addEventListener('click', copyShareLink);
            
            // 導出PDF - 使用更簡單的方法
            exportBtn.addEventListener('click', exportToPDFSimple);
            
            // 刷新天氣
            refreshWeatherBtn.addEventListener('click', refreshWeather);
            
            // 編輯圖標點擊
            document.querySelectorAll('.edit-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    if (!isEditMode) {
                        toggleEditMode();
                        showNotification('已進入編輯模式');
                    }
                });
            });
            
            // 內容編輯事件
            document.addEventListener('input', handleContentEdit);
            
            // 頁面載入時自動保存數據狀態
            window.addEventListener('load', function() {
                updateDataStatus();
            });
        }
        
        // 切換編輯模式
        function toggleEditMode() {
            isEditMode = !isEditMode;
            
            // 切換所有可編輯元素的狀態
            const editableElements = document.querySelectorAll('.editable, [contenteditable="true"]');
            editableElements.forEach(el => {
                el.contentEditable = isEditMode;
                el.classList.toggle('edit-mode', isEditMode);
            });
            
            // 更新按鈕文本
            toggleEditBtn.innerHTML = isEditMode ? 
                '<i class="fas fa-save"></i> 保存並退出編輯' : 
                '<i class="fas fa-edit"></i> 編輯模式';
            
            // 切換按鈕顏色
            toggleEditBtn.classList.toggle('btn-primary', isEditMode);
            toggleEditBtn.classList.toggle('btn-edit', !isEditMode);
            
            if (!isEditMode) {
                // 退出編輯模式時保存數據
                saveDataToStorage();
                showNotification('內容已保存');
            }
        }
        
        // 處理內容編輯
        function handleContentEdit(e) {
            if (!isEditMode) return;
            
            // 防抖動，減少頻繁保存
            clearTimeout(editTimeout);
            editTimeout = setTimeout(() => {
                saveDataToStorage();
                updateShareLink();
            }, 1500);
        }
        
        // 保存數據到本地存儲和數據對象
        function saveDataToStorage() {
            try {
                // 收集所有可編輯的內容
                const savedData = {
                    title: document.getElementById('tripTitle').textContent,
                    subtitle: document.getElementById('tripSubtitle').textContent,
                    overview: {
                        dates: document.getElementById('tripDates').textContent,
                        days: document.getElementById('tripDays').textContent,
                        people: document.getElementById('tripPeople').textContent,
                        transport: document.getElementById('tripTransport').textContent,
                        route: document.getElementById('tripRoute').textContent
                    },
                    lastUpdated: new Date().toLocaleDateString('zh-Hant', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })
                };
                
                // 收集航班信息
                savedData.flights = {
                    outbound: Array.from(document.querySelectorAll('#editFlightOut').closest('.card').querySelectorAll('.editable')).map(el => el.textContent),
                    inbound: Array.from(document.querySelectorAll('#editFlightIn').closest('.card').querySelectorAll('.editable')).map(el => el.textContent)
                };
                
                // 收集每日行程數據
                const dayCards = document.querySelectorAll('.day-card');
                savedData.days = [];
                
                dayCards.forEach((card, index) => {
                    const dayTitle = card.querySelector('.day-title').textContent;
                    const dayTheme = card.querySelector('.day-theme').textContent;
                    const activities = [];
                    
                    card.querySelectorAll('.activity-item').forEach(item => {
                        const time = item.querySelector('.activity-time').textContent;
                        const desc = item.querySelector('.activity-desc').textContent;
                        activities.push({ time, desc });
                    });
                    
                    savedData.days.push({
                        title: dayTitle,
                        theme: dayTheme,
                        activities: activities
                    });
                });
                
                // 收集其他表格數據
                savedData.tables = {};
                document.querySelectorAll('.cost-table').forEach((table, index) => {
                    const rows = [];
                    table.querySelectorAll('tr').forEach(row => {
                        const cells = Array.from(row.querySelectorAll('th, td')).map(cell => cell.textContent);
                        rows.push(cells);
                    });
                    savedData.tables[`table${index}`] = rows;
                });
                
                // 保存到本地存儲
                localStorage.setItem('tripData_v2', JSON.stringify(savedData));
                
                // 更新頁面顯示的最後修改時間
                lastUpdatedEl.textContent = savedData.lastUpdated;
                
                // 更新tripData對象
                tripData = savedData;
                
                // 更新數據狀態
                updateDataStatus();
                
                console.log('數據已保存:', savedData);
                return true;
            } catch (error) {
                console.error('保存數據時出錯:', error);
                showNotification('保存失敗，請稍後再試');
                return false;
            }
        }
        
        // 從本地存儲加載數據
        function loadDataFromStorage() {
            try {
                const savedData = localStorage.getItem('tripData_v2');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    applyDataToPage(data);
                    
                    // 更新tripData對象
                    tripData = data;
                    
                    showNotification('行程數據已載入');
                    updateDataStatus();
                    return true;
                } else {
                    // 嘗試載入舊版本數據
                    const oldData = localStorage.getItem('tripData');
                    if (oldData) {
                        const data = JSON.parse(oldData);
                        applyDataToPage(data);
                        tripData = data;
                        showNotification('載入舊版本數據');
                        updateDataStatus();
                        return true;
                    }
                    showNotification('沒有找到保存的行程數據');
                    return false;
                }
            } catch (e) {
                console.error('無法載入行程數據:', e);
                showNotification('載入失敗，請檢查數據格式');
                return false;
            }
        }
        
        // 將數據應用到頁面
        function applyDataToPage(data) {
            // 應用基本數據
            document.getElementById('tripTitle').textContent = data.title || tripData.title;
            document.getElementById('tripSubtitle').textContent = data.subtitle || tripData.subtitle;
            
            if (data.overview) {
                document.getElementById('tripDates').textContent = data.overview.dates || tripData.overview.dates;
                document.getElementById('tripDays').textContent = data.overview.days || tripData.overview.days;
                document.getElementById('tripPeople').textContent = data.overview.people || tripData.overview.people;
                document.getElementById('tripTransport').textContent = data.overview.transport || tripData.overview.transport;
                document.getElementById('tripRoute').textContent = data.overview.route || tripData.overview.route;
            }
            
            if (data.lastUpdated) {
                lastUpdatedEl.textContent = data.lastUpdated;
            }
            
            // 應用航班信息
            if (data.flights) {
                const outboundEditable = document.querySelectorAll('#editFlightOut').closest('.card').querySelectorAll('.editable');
                if (data.flights.outbound && outboundEditable.length >= data.flights.outbound.length) {
                    data.flights.outbound.forEach((text, index) => {
                        if (outboundEditable[index]) {
                            outboundEditable[index].textContent = text;
                        }
                    });
                }
                
                const inboundEditable = document.querySelectorAll('#editFlightIn').closest('.card').querySelectorAll('.editable');
                if (data.flights.inbound && inboundEditable.length >= data.flights.inbound.length) {
                    data.flights.inbound.forEach((text, index) => {
                        if (inboundEditable[index]) {
                            inboundEditable[index].textContent = text;
                        }
                    });
                }
            }
            
            // 應用每日行程
            if (data.days && data.days.length > 0) {
                const dayCards = document.querySelectorAll('.day-card');
                dayCards.forEach((card, index) => {
                    if (data.days[index]) {
                        if (card.querySelector('.day-title')) {
                            card.querySelector('.day-title').textContent = data.days[index].title;
                        }
                        if (card.querySelector('.day-theme')) {
                            card.querySelector('.day-theme').textContent = data.days[index].theme;
                        }
                        
                        const activities = card.querySelectorAll('.activity-item');
                        if (data.days[index].activities) {
                            data.days[index].activities.forEach((activity, activityIndex) => {
                                if (activities[activityIndex]) {
                                    if (activities[activityIndex].querySelector('.activity-time')) {
                                        activities[activityIndex].querySelector('.activity-time').textContent = activity.time;
                                    }
                                    if (activities[activityIndex].querySelector('.activity-desc')) {
                                        activities[activityIndex].querySelector('.activity-desc').textContent = activity.desc;
                                    }
                                }
                            });
                        }
                    }
                });
            }
            
            // 應用表格數據
            if (data.tables) {
                const tables = document.querySelectorAll('.cost-table');
                Object.keys(data.tables).forEach((tableKey, index) => {
                    if (tables[index]) {
                        const rows = tables[index].querySelectorAll('tr');
                        const tableData = data.tables[tableKey];
                        
                        tableData.forEach((rowData, rowIndex) => {
                            if (rows[rowIndex]) {
                                const cells = rows[rowIndex].querySelectorAll('th, td');
                                rowData.forEach((cellData, cellIndex) => {
                                    if (cells[cellIndex]) {
                                        cells[cellIndex].textContent = cellData;
                                    }
                                });
                            }
                        });
                    }
                });
            }
            
            // 應用預算總表
            if (data.budgetTotal) {
                const budgetTotal = document.querySelector('.budget-total');
                if (budgetTotal) {
                    if (budgetTotal.querySelector('.budget-total-label')) {
                        budgetTotal.querySelector('.budget-total-label').textContent = data.budgetTotal.label || '';
                    }
                    if (budgetTotal.querySelector('.budget-total-value')) {
                        budgetTotal.querySelector('.budget-total-value').textContent = data.budgetTotal.value || '';
                    }
                }
            }
        }
        
        // 更新分享連結
        function updateShareLink() {
            try {
                // 確保tripData是最新的
                saveDataToStorage();
                
                // 創建包含行程數據的分享連結
                const dataString = encodeURIComponent(JSON.stringify(tripData));
                const currentUrl = window.location.href.split('?')[0];
                const shareUrl = `${currentUrl}?trip=${dataString}`;
                
                shareableLink.value = shareUrl;
            } catch (error) {
                console.error('更新分享連結時出錯:', error);
                shareableLink.value = window.location.href;
            }
        }
        
        // 檢查URL參數並加載行程數據
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const tripParam = urlParams.get('trip');
            
            if (tripParam) {
                try {
                    const sharedData = JSON.parse(decodeURIComponent(tripParam));
                    applyDataToPage(sharedData);
                    
                    // 保存到本地存儲
                    localStorage.setItem('tripData_v2', JSON.stringify(sharedData));
                    
                    // 更新tripData對象
                    tripData = sharedData;
                    
                    showNotification('已加載共享的行程數據');
                    updateDataStatus();
                } catch (e) {
                    console.error('無法解析URL中的行程數據:', e);
                    // 如果無法解析URL參數，嘗試從本地存儲加載
                    loadDataFromStorage();
                }
            } else {
                // 如果沒有URL參數，嘗試從本地存儲加載
                loadDataFromStorage();
            }
        }
        
        // 複製分享連結
        function copyShareLink() {
            shareableLink.select();
            shareableLink.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                const originalText = copyLinkBtn.textContent;
                copyLinkBtn.textContent = '已複製!';
                copyLinkBtn.style.backgroundColor = '#4CAF50';
                
                showNotification('連結已複製到剪貼簿');
                
                setTimeout(() => {
                    copyLinkBtn.textContent = originalText;
                    copyLinkBtn.style.backgroundColor = '#2a5298';
                }, 2000);
            } catch (err) {
                // 使用現代 Clipboard API
                navigator.clipboard.writeText(shareableLink.value).then(() => {
                    const originalText = copyLinkBtn.textContent;
                    copyLinkBtn.textContent = '已複製!';
                    copyLinkBtn.style.backgroundColor = '#4CAF50';
                    
                    showNotification('連結已複製到剪貼簿');
                    
                    setTimeout(() => {
                        copyLinkBtn.textContent = originalText;
                        copyLinkBtn.style.backgroundColor = '#2a5298';
                    }, 2000);
                });
            }
        }
        
        // 分享到Facebook
        function shareOnFacebook() {
            const url = encodeURIComponent(shareableLink.value);
            const text = encodeURIComponent(`查看我的英國旅遊行程：${tripData.title}`);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
        }
        
        // 分享到WhatsApp
        function shareOnWhatsApp() {
            const text = encodeURIComponent(`查看我的英國旅遊行程：${tripData.title}\n${shareableLink.value}`);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }
        
        // 簡單的PDF導出方法（使用html2canvas）
        async function exportToPDFSimple() {
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在生成PDF...';
            exportBtn.disabled = true;
            
            try {
                // 臨時退出編輯模式以獲得更好的PDF效果
                const wasEditMode = isEditMode;
                if (wasEditMode) toggleEditMode();
                
                // 隱藏不需要的元素
                const originalDisplay = [];
                const elementsToHide = document.querySelectorAll('.action-buttons, .edit-icon, .share-modal, .notification, .data-status');
                elementsToHide.forEach(el => {
                    originalDisplay.push({element: el, display: el.style.display});
                    el.style.display = 'none';
                });
                
                // 為每個主要部分生成PDF頁面
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // 獲取所有卡片
                const cards = document.querySelectorAll('.card');
                let pageNum = 1;
                
                // 添加封面
                pdf.setFillColor(30, 60, 114);
                pdf.rect(0, 0, 210, 297, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(28);
                pdf.text("英國17天行程", 105, 120, { align: 'center' });
                pdf.setFontSize(16);
                pdf.text(tripData.subtitle, 105, 140, { align: 'center' });
                pdf.setFontSize(12);
                pdf.text(`最後更新: ${tripData.lastUpdated}`, 105, 160, { align: 'center' });
                pdf.setTextColor(255, 126, 95);
                pdf.text("旅遊行程計劃", 105, 180, { align: 'center' });
                
                pageNum++;
                pdf.addPage();
                
                // 使用html2canvas將每個卡片轉換為圖片
                for (let i = 0; i < cards.length; i++) {
                    const card = cards[i];
                    
                    // 檢查是否需要新頁面
                    if (i > 0 && i % 2 === 0) {
                        pageNum++;
                        pdf.addPage();
                    }
                    
                    try {
                        const canvas = await html2canvas(card, {
                            scale: 1.5,
                            useCORS: true,
                            logging: false,
                            backgroundColor: '#ffffff'
                        });
                        
                        const imgData = canvas.toDataURL('image/jpeg', 0.9);
                        const imgWidth = 190; // A4寬度減去邊距
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        // 計算位置（每頁兩個卡片）
                        const x = 10; // 左邊距
                        let y;
                        
                        if (i % 2 === 0) {
                            y = 20; // 第一個卡片的位置
                        } else {
                            y = 150; // 第二個卡片的位置
                        }
                        
                        // 添加圖片到PDF
                        pdf.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);
                        
                    } catch (error) {
                        console.error(`處理卡片 ${i} 時出錯:`, error);
                        // 如果無法生成圖片，添加文本替代
                        const cardTitle = card.querySelector('.card-title span')?.textContent || `卡片 ${i+1}`;
                        pdf.setFontSize(14);
                        pdf.setTextColor(30, 60, 114);
                        pdf.text(cardTitle, 15, 20 + (i % 2) * 130);
                    }
                    
                    // 如果是最後一個卡片或需要換頁
                    if (i === cards.length - 1 || i % 2 === 1) {
                        // 添加頁碼
                        pdf.setFontSize(10);
                        pdf.setTextColor(100, 100, 100);
                        pdf.text(`第 ${pageNum} 頁`, 200, 290, { align: 'right' });
                        
                        if (i !== cards.length - 1) {
                            pageNum++;
                            pdf.addPage();
                        }
                    }
                }
                
                // 恢復隱藏的元素
                elementsToHide.forEach((el, index) => {
                    el.style.display = originalDisplay[index].display;
                });
                
                // 恢復編輯模式
                if (wasEditMode) toggleEditMode();
                
                // 保存PDF
                pdf.save(`英國旅遊行程-${new Date().toISOString().split('T')[0]}.pdf`);
                
                exportBtn.innerHTML = '<i class="fas fa-file-pdf"></i> 導出PDF';
                exportBtn.disabled = false;
                
                showNotification('PDF已成功導出，共' + pageNum + '頁');
                
            } catch (error) {
                console.error('PDF生成錯誤:', error);
                
                // 嘗試更簡單的方法
                try {
                    // 使用html2canvas捕獲整個頁面
                    const element = document.querySelector('.container');
                    const canvas = await html2canvas(element, {
                        scale: 1,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#f8f9fa'
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.9);
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const imgWidth = 210;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    pdf.save(`英國旅遊行程-簡單版-${new Date().toISOString().split('T')[0]}.pdf`);
                    
                    showNotification('PDF已導出（簡單版）');
                } catch (simpleError) {
                    alert('PDF導出失敗，請確保網路連接正常並稍後再試。錯誤: ' + simpleError.message);
                }
                
                exportBtn.innerHTML = '<i class="fas fa-file-pdf"></i> 導出PDF';
                exportBtn.disabled = false;
                
                // 恢復編輯模式
                if (isEditMode) toggleEditMode();
            }
        }
        
        // 刷新天氣預報
        function refreshWeather() {
            showNotification('正在更新天氣預報...');
            
            setTimeout(() => {
                weatherData.forEach(day => {
                    const currentTemp = parseInt(day.temp);
                    const newTemp = Math.max(10, Math.min(25, currentTemp + Math.floor(Math.random() * 5) - 2));
                    day.temp = `${newTemp}°C`;
                    
                    const conditions = ['晴', '多雲', '多雲時晴', '小雨', '陣雨', '多雲偶雨'];
                    day.desc = conditions[Math.floor(Math.random() * conditions.length)];
                    
                    if (day.desc === '晴') day.icon = 'fa-sun';
                    else if (day.desc.includes('雨')) day.icon = 'fa-cloud-rain';
                    else if (day.desc === '多雲') day.icon = 'fa-cloud';
                    else day.icon = 'fa-cloud-sun';
                });
                
                renderWeather();
                showNotification('天氣預報已更新');
            }, 1000);
        }
        
        // 顯示通知
        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // 更新數據狀態顯示
        function updateDataStatus() {
            const hasData = localStorage.getItem('tripData_v2') || localStorage.getItem('tripData');
            dataStatus.textContent = hasData ? `數據已保存 (${tripData.lastUpdated})` : '無保存數據';
            dataStatus.style.backgroundColor = hasData ? '#4CAF50' : '#ff7e5f';
        }
        
        // 添加一些互動效果
        document.querySelectorAll('.day-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
                this.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.1)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.05)';
            });
        });
        
        // 初始化頁面
        document.addEventListener('DOMContentLoaded', function() {
            initPage();
        });
    </script>
</body>
</html>
